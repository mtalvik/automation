<!doctype html><html lang=et class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Infrastruktuuri automatiseerimine ja haldus - praktilised oskused"><meta name=author content="Maria Talvik"><link href=https://mtalvik.github.io/automation/ansible_basics/lecture/ rel=canonical><link href=../../docker_orchestration/homework/ rel=prev><link href=../lab/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.20"><title>Ansible alused - Automatiseerimine</title><link rel=stylesheet href=../../assets/stylesheets/main.e53b48f4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-XXXXXXXXXX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#ansible-basics-alused class=md-skip> Keri sisuni </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Päis> <a href=../.. title=Automatiseerimine class="md-header__button md-logo" aria-label=Automatiseerimine data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Automatiseerimine </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Ansible alused </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Vaheta tumele režiimile" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Vaheta tumele režiimile" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Vaheta tumele režiimile" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Vaheta tumele režiimile" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Vaheta heledasse režiimi" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Vaheta heledasse režiimi" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Otsi placeholder=Otsi autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Otsing> <a href=javascript:void(0) class="md-search__icon md-icon" title=Jaga aria-label=Jaga data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Lähtesta aria-label=Lähtesta tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Otsingu lähtestamine </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/mtalvik/automation title="Ava repositooriumis" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> mtalvik/automation </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Vaheleht data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Avaleht </a> </li> <li class=md-tabs__item> <a href=../../curriculum/ class=md-tabs__link> Õppekava </a> </li> <li class=md-tabs__item> <a href=../../git_version_control/lab/ class=md-tabs__link> Git </a> </li> <li class=md-tabs__item> <a href=../../docker_fundamentals/lecture/ class=md-tabs__link> Docker </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Ansible </a> </li> <li class=md-tabs__item> <a href=../../ci_cd_advanced/lecture/ class=md-tabs__link> CI/CD </a> </li> <li class=md-tabs__item> <a href=../../kubernetes_overview/lecture/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../terraform_basics/lecture/ class=md-tabs__link> Terraform </a> </li> <li class=md-tabs__item> <a href=../../assignments/ class=md-tabs__link> Ülesanded </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigatsioon data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=Automatiseerimine class="md-nav__button md-logo" aria-label=Automatiseerimine data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Automatiseerimine </label> <div class=md-nav__source> <a href=https://github.com/mtalvik/automation title="Ava repositooriumis" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> mtalvik/automation </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Avaleht </span> </a> </li> <li class=md-nav__item> <a href=../../curriculum/ class=md-nav__link> <span class=md-ellipsis> Õppekava </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Git </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../git_version_control/lab/ class=md-nav__link> <span class=md-ellipsis> Praktikum </span> </a> </li> <li class=md-nav__item> <a href=../../git_version_control/homework/ class=md-nav__link> <span class=md-ellipsis> Kodutöö </span> </a> </li> <li class=md-nav__item> <a href=../../git_version_control/reading_materials/ class=md-nav__link> <span class=md-ellipsis> Materjalid </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docker_fundamentals/lecture/ class=md-nav__link> <span class=md-ellipsis> Docker alused </span> </a> </li> <li class=md-nav__item> <a href=../../docker_fundamentals/lab/ class=md-nav__link> <span class=md-ellipsis> Docker praktikum </span> </a> </li> <li class=md-nav__item> <a href=../../docker_fundamentals/homework/ class=md-nav__link> <span class=md-ellipsis> Docker kodutöö </span> </a> </li> <li class=md-nav__item> <a href=../../docker_orchestration/lecture/ class=md-nav__link> <span class=md-ellipsis> Orkestreerimine </span> </a> </li> <li class=md-nav__item> <a href=../../docker_orchestration/lab/ class=md-nav__link> <span class=md-ellipsis> Orkestreerimise praktikum </span> </a> </li> <li class=md-nav__item> <a href=../../docker_orchestration/homework/ class=md-nav__link> <span class=md-ellipsis> Orkestreerimise kodutöö </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Ansible </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Ansible alused </span> </a> </li> <li class=md-nav__item> <a href=../lab/ class=md-nav__link> <span class=md-ellipsis> Ansible praktikum </span> </a> </li> <li class=md-nav__item> <a href=../homework/ class=md-nav__link> <span class=md-ellipsis> Ansible kodutöö </span> </a> </li> <li class=md-nav__item> <a href=../reading_materials/ class=md-nav__link> <span class=md-ellipsis> Ansible materjalid </span> </a> </li> <li class=md-nav__item> <a href=../../ansible_advanced/lecture/ class=md-nav__link> <span class=md-ellipsis> Advanced </span> </a> </li> <li class=md-nav__item> <a href=../../ansible_roles/lecture/ class=md-nav__link> <span class=md-ellipsis> Rollid </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> CI/CD </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> CI/CD </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ci_cd_advanced/lecture/ class=md-nav__link> <span class=md-ellipsis> Teooria </span> </a> </li> <li class=md-nav__item> <a href=../../ci_cd_advanced/lab/ class=md-nav__link> <span class=md-ellipsis> Praktikum </span> </a> </li> <li class=md-nav__item> <a href=../../ci_cd_advanced/homework/ class=md-nav__link> <span class=md-ellipsis> Kodutöö </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes_overview/lecture/ class=md-nav__link> <span class=md-ellipsis> Teooria </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes_overview/lab/ class=md-nav__link> <span class=md-ellipsis> Praktikum </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes_overview/homework/ class=md-nav__link> <span class=md-ellipsis> Kodutöö </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Terraform </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Terraform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../terraform_basics/lecture/ class=md-nav__link> <span class=md-ellipsis> Teooria </span> </a> </li> <li class=md-nav__item> <a href=../../terraform_basics/lab/ class=md-nav__link> <span class=md-ellipsis> Praktikum </span> </a> </li> <li class=md-nav__item> <a href=../../terraform_basics/homework/ class=md-nav__link> <span class=md-ellipsis> Kodutöö </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <div class="md-nav__link md-nav__container"> <a href=../../assignments/ class="md-nav__link "> <span class=md-ellipsis> Ülesanded </span> </a> <label class="md-nav__link " for=__nav_9 id=__nav_9_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Ülesanded </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../assignments/classroom/ class=md-nav__link> <span class=md-ellipsis> GitHub Classroom </span> </a> </li> <li class=md-nav__item> <a href=../../assignments/leaderboard/ class=md-nav__link> <span class=md-ellipsis> Leaderboard </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=Sisukord> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/mtalvik/automation/edit/main/ansible_basics/lecture.md title="Muuda seda lehte" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg> </a> <a href=https://github.com/mtalvik/automation/raw/main/ansible_basics/lecture.md title="Vaata lehe lähtekoodi" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg> </a> <h1 id=ansible-basics-alused>📚 Ansible Basics: Alused<a class=headerlink href=#ansible-basics-alused title="Permanent link">&para;</a></h1> <h1 id=21-ansible-arhitektuur-ja-pohimotted>2.1 Ansible Arhitektuur ja Põhimõtted<a class=headerlink href=#21-ansible-arhitektuur-ja-pohimotted title="Permanent link">&para;</a></h1> <h2 id=sissejuhatus-automatiseerimisse>Sissejuhatus automatiseerimisse<a class=headerlink href=#sissejuhatus-automatiseerimisse title="Permanent link">&para;</a></h2> <p>Süsteemiadministreerimine traditsioonilistel meetoditel tekitab skaleerumisel märkimisväärseid väljakutseid. Suurtes infrastruktuurides, kus hallatakse kümneid või sadu servereid, muutub käsitsi konfiguratsioonide haldamine aeganõudvaks ja vigadele vastuvõtlikuks.</p> <p>Ansible on open-source automatiseerimisplatvorm, mis lahendab süsteemihalduse, rakenduste juurutamise ja konfiguratsioonide haldamise ülesandeid. Ansible'i peamised eelised on agentless arhitektuur, deklaratiivne süntaks ja idempotentsed operatsioonid.</p> <h2 id=ansible-arhitektuur>Ansible arhitektuur<a class=headerlink href=#ansible-arhitektuur title="Permanent link">&para;</a></h2> <h3 id=agentless-lahenemine>Agentless lähenemine<a class=headerlink href=#agentless-lahenemine title="Permanent link">&para;</a></h3> <p>Ansible kasutab agentless arhitektuuri, mis eristab seda paljudest konkureerivtest lahendustest. See tähendab, et hallatavates süsteemides ei ole vaja installida ja hooldada täiendavat tarkvara.</p> <pre class=mermaid><code>graph TB
    subgraph "Control Node"
        Ansible[Ansible Engine]
        Inventory[Inventory]
        Playbooks[Playbooks]
    end

    subgraph "Managed Nodes"
        Web1[Web Server 1]
        Web2[Web Server 2]
        DB1[Database 1]
        DB2[Database 2]
    end

    Ansible --&gt;|SSH| Web1
    Ansible --&gt;|SSH| Web2
    Ansible --&gt;|SSH| DB1
    Ansible --&gt;|SSH| DB2

    Inventory --&gt; Ansible
    Playbooks --&gt; Ansible

    style Ansible fill:#ff9999
    style Inventory fill:#99ccff
    style Playbooks fill:#99ff99
    style Web1 fill:#ffcc99
    style Web2 fill:#ffcc99
    style DB1 fill:#cc99ff
    style DB2 fill:#cc99ff</code></pre> <p><strong>Nõuded hallatavates süsteemides:</strong> - SSH server aktiivsena - Python interpreter (versioon 2.7 või 3.5+) - Vajalikud süsteemi õigused operatsioonide sooritamiseks</p> <h3 id=pohikomponendid>Põhikomponendid<a class=headerlink href=#pohikomponendid title="Permanent link">&para;</a></h3> <h4 id=control-node>Control Node<a class=headerlink href=#control-node title="Permanent link">&para;</a></h4> <p>Control node on süsteem, kus Ansible on installitud ja kust käivitatakse automatiseerimise käsud. Control node nõuded: - Unix-laadne operatsioonisüsteem (Linux, macOS) - Python 3.8 või uuem versioon - SSH klient</p> <h4 id=managed-nodes>Managed Nodes<a class=headerlink href=#managed-nodes title="Permanent link">&para;</a></h4> <p>Managed nodes on sihtmärgid, mida Ansible haldab. Need võivad olla füüsilised serverid, virtuaalmasinad või pilveressursid.</p> <h4 id=inventory>Inventory<a class=headerlink href=#inventory title="Permanent link">&para;</a></h4> <p>Inventory on struktureeritud fail või andmebaas, mis määratleb hallatavate süsteemide nimekirja ja nende grupeerimise loogika.</p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>[webservers]</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=na>web1.example.com</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=na>web2.example.com</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=k>[databases]</span><span class=w> </span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=na>db1.example.com</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=na>db2.example.com</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=k>[production:children]</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=na>webservers</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=na>databases</span>
</span></code></pre></div> <h4 id=modules>Modules<a class=headerlink href=#modules title="Permanent link">&para;</a></h4> <p>Moodulid on abstraktsed ühikud, mis kapseldavad konkreetseid funktsionaalsusi. Ansible sisaldab üle 3000 mooduli, mis katavad süsteemihalduse, võrgukonfiguratsiooni, pilveplatformide ja rakenduste haldamise vajadused.</p> <h3 id=toovoog>Töövoog<a class=headerlink href=#toovoog title="Permanent link">&para;</a></h3> <p>Ansible'i täitmistsükkel koosneb järgmistest sammudest:</p> <pre class=mermaid><code>flowchart TD
    A[Inventory lugemine] --&gt; B[SSH ühendused]
    B --&gt; C[Mooduli koodi edastamine]
    C --&gt; D[Operatsioonide täitmine]
    D --&gt; E[Tulemuste kogumine]
    E --&gt; F[Ajutiste failide eemaldamine]

    style A fill:#99ccff
    style B fill:#ffcc99
    style C fill:#99ff99
    style D fill:#ff9999
    style E fill:#cc99ff
    style F fill:#ffff99</code></pre> <ol> <li><strong>Inventory lugemine</strong> - süsteemide nimekirja laadimine</li> <li><strong>SSH ühenduste loomine</strong> - paralleelsed ühendused sihtmärkidega</li> <li><strong>Mooduli koodi edastamine</strong> - vajalike Python skriptide ajutine kopeerimine</li> <li><strong>Operatsioonide täitmine</strong> - käskude paralleelne käivitamine</li> <li><strong>Tulemuste kogumine</strong> - väljundi ja staatuse tagastamine</li> <li><strong>Ajutiste failide eemaldamine</strong> - puhastusoperatsioonid</li> </ol> <h2 id=idempotency-printsiip>Idempotency printsiip<a class=headerlink href=#idempotency-printsiip title="Permanent link">&para;</a></h2> <p>Idempotency on Ansible'i põhiprintsiip, mis tagab, et sama operatsiooni korduvkäivitamine ei muuda süsteemi olekut, kui soovitud olek on juba saavutatud.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># Esimene käivitamine - nginx installitakse</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>package<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=nginx state=present&quot;</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=c1># Teine käivitamine - nginx on juba olemas, muudatusi ei tehta</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>package<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=nginx state=present&quot;</span>
</span></code></pre></div> <p>Idempotency eelised: - <strong>Turvalisus</strong> - operatsioonide korduvkäivitamine ei tekita kahjulikke kõrvalmõjusid - <strong>Etteennustatavus</strong> - süsteemi lõppolek on alati sama - <strong>Usaldusväärsus</strong> - automatiseerimise skriptid on stabiilsed</p> <h2 id=vordlus-konkurentidega>Võrdlus konkurentidega<a class=headerlink href=#vordlus-konkurentidega title="Permanent link">&para;</a></h2> <h3 id=ansible-vs-puppet>Ansible vs Puppet<a class=headerlink href=#ansible-vs-puppet title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Aspekt</th> <th>Ansible</th> <th>Puppet</th> </tr> </thead> <tbody> <tr> <td>Arhitektuur</td> <td>Agentless</td> <td>Agent-põhine</td> </tr> <tr> <td>Konfiguratsioon</td> <td>YAML</td> <td>Ruby DSL</td> </tr> <tr> <td>Mudel</td> <td>Push</td> <td>Pull</td> </tr> <tr> <td>Õppimiskõver</td> <td>Madal</td> <td>Kõrge</td> </tr> </tbody> </table> <h3 id=ansible-vs-chef>Ansible vs Chef<a class=headerlink href=#ansible-vs-chef title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Aspekt</th> <th>Ansible</th> <th>Chef</th> </tr> </thead> <tbody> <tr> <td>Keel</td> <td>YAML</td> <td>Ruby</td> </tr> <tr> <td>Seadistamine</td> <td>Lihtne</td> <td>Keeruline</td> </tr> <tr> <td>Skaleeritavus</td> <td>Hea</td> <td>Väga hea</td> </tr> <tr> <td>Ökosüsteem</td> <td>Lai</td> <td>Lai</td> </tr> </tbody> </table> <h2 id=praktiline-naide>Praktiline näide<a class=headerlink href=#praktiline-naide title="Permanent link">&para;</a></h2> <p>Lihtne ühenduvuse testimine:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># SSH võtmete seadistamine</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>ssh-keygen<span class=w> </span>-t<span class=w> </span>ed25519<span class=w> </span>-f<span class=w> </span>~/.ssh/ansible_key
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>ssh-copy-id<span class=w> </span>-i<span class=w> </span>~/.ssh/ansible_key.pub<span class=w> </span>user@target_host
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=c1># Inventory loomine</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;target_host ansible_user=user&quot;</span><span class=w> </span>&gt;<span class=w> </span>inventory
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=c1># Ühenduvuse testimine</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>ansible<span class=w> </span>-i<span class=w> </span>inventory<span class=w> </span>target_host<span class=w> </span>-m<span class=w> </span>ping
</span></code></pre></div> <p>Oodatav väljund: <div class="language-json highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=kc>tar</span><span class=err>ge</span><span class=kc>t</span><span class=err>_hos</span><span class=kc>t</span><span class=w> </span><span class=err>|</span><span class=w> </span><span class=err>SUCCESS</span><span class=w> </span><span class=err>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>    </span><span class=nt>&quot;ansible_facts&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>        </span><span class=nt>&quot;discovered_interpreter_python&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;/usr/bin/python3&quot;</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=w>    </span><span class=nt>&quot;changed&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>    </span><span class=nt>&quot;ping&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pong&quot;</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=p>}</span>
</span></code></pre></div></p> <h2 id=kokkuvote>Kokkuvõte<a class=headerlink href=#kokkuvote title="Permanent link">&para;</a></h2> <p>Ansible pakub tõhusat lahendust infrastruktuuri automatiseerimiseks. Agentless arhitektuur, lihtne YAML süntaks ja idempotentsed operatsioonid muudavad selle sobivaks nii väikestele kui suurtele keskkondadele. Järgnevates peatükkides käsitletakse SSH konfiguratsiooni, inventory haldamist ja playbook'ide arendamist.</p> <h1 id=22-ssh-ja-inventory-konfigureerimine>2.2 SSH ja Inventory konfigureerimine<a class=headerlink href=#22-ssh-ja-inventory-konfigureerimine title="Permanent link">&para;</a></h1> <h2 id=ssh-autentimise-alused>SSH autentimise alused<a class=headerlink href=#ssh-autentimise-alused title="Permanent link">&para;</a></h2> <p>Ansible tugineb SSH protokollile kommunikatsiooniks hallatavate süsteemidega. Tõhusa automatiseerimise saavutamiseks on vajalik seadistada võtme-põhine autentimine, mis elimineerib interaktiivse parooli sisestamise vajaduse.</p> <h3 id=ssh-votmete-genereerimine>SSH võtmete genereerimine<a class=headerlink href=#ssh-votmete-genereerimine title="Permanent link">&para;</a></h3> <p>SSH võtmepaaride loomine toimub <code>ssh-keygen</code> utiliidiga. Soovitatav on kasutada Ed25519 algoritmi turvalisuse ja jõudluse optimaalse tasakaalu saavutamiseks.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># Ed25519 võtme genereerimine</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>ssh-keygen<span class=w> </span>-t<span class=w> </span>ed25519<span class=w> </span>-C<span class=w> </span><span class=s2>&quot;ansible-automation&quot;</span><span class=w> </span>-f<span class=w> </span>~/.ssh/ansible_ed25519
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=c1># RSA võtme genereerimine (vajadusel)</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>ssh-keygen<span class=w> </span>-t<span class=w> </span>rsa<span class=w> </span>-b<span class=w> </span><span class=m>4096</span><span class=w> </span>-C<span class=w> </span><span class=s2>&quot;ansible-automation&quot;</span><span class=w> </span>-f<span class=w> </span>~/.ssh/ansible_rsa
</span></code></pre></div> <p><strong>Parameetrite selgitus:</strong> - <code>-t</code> - krüptograafilise algoritmi määramine - <code>-b</code> - võtme pikkus bittides (RSA jaoks) - <code>-C</code> - kommentaar võtme identifitseerimiseks - <code>-f</code> - väljundfaili asukoha määramine</p> <h3 id=ssh-agendi-konfigureerimine>SSH agendi konfigureerimine<a class=headerlink href=#ssh-agendi-konfigureerimine title="Permanent link">&para;</a></h3> <p>SSH agent hõlbustab privaatvõtmete haldamist, lubades autentimist ilma korduvate paroolide sisestamiseta.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># SSH agendi käivitamine</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=nb>eval</span><span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>ssh-agent<span class=w> </span>-s<span class=k>)</span><span class=s2>&quot;</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=c1># Privaatvõtme lisamine agenti</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>ssh-add<span class=w> </span>~/.ssh/ansible_ed25519
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=c1># Agendis olevate võtmete kontroll</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>ssh-add<span class=w> </span>-l
</span></code></pre></div> <p>Automaatse agendi käivitamise seadistamine shell'i konfiguratsioonis:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># ~/.bashrc või ~/.zshrc</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$SSH_AUTH_SOCK</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>    </span><span class=nb>eval</span><span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>ssh-agent<span class=w> </span>-s<span class=k>)</span><span class=s2>&quot;</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>    </span>ssh-add<span class=w> </span>~/.ssh/ansible_ed25519<span class=w> </span><span class=m>2</span>&gt;/dev/null
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=k>fi</span>
</span></code></pre></div> <h3 id=avalike-votmete-levitamine>Avalike võtmete levitamine<a class=headerlink href=#avalike-votmete-levitamine title="Permanent link">&para;</a></h3> <p>Avalike võtmete autoriseeritud võtmete nimekirja lisamine:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1># ssh-copy-id kasutamine (lihtsaim)</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>ssh-copy-id<span class=w> </span>-i<span class=w> </span>~/.ssh/ansible_ed25519.pub<span class=w> </span>kasutaja@sihtserver
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=c1># Käsitsi kopeerimine</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>cat<span class=w> </span>~/.ssh/ansible_ed25519.pub<span class=w> </span><span class=p>|</span><span class=w> </span>ssh<span class=w> </span>kasutaja@sihtserver<span class=w> </span><span class=se>\</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=w>  </span><span class=s2>&quot;mkdir -p ~/.ssh &amp;&amp; cat &gt;&gt; ~/.ssh/authorized_keys&quot;</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=c1># Batch levitamine</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=k>for</span><span class=w> </span>server<span class=w> </span><span class=k>in</span><span class=w> </span>server1<span class=w> </span>server2<span class=w> </span>server3<span class=p>;</span><span class=w> </span><span class=k>do</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=w>    </span>ssh-copy-id<span class=w> </span>-i<span class=w> </span>~/.ssh/ansible_ed25519.pub<span class=w> </span>kasutaja@<span class=nv>$server</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=k>done</span>
</span></code></pre></div> <h2 id=inventory-struktuur-ja-formaat>Inventory struktuur ja formaat<a class=headerlink href=#inventory-struktuur-ja-formaat title="Permanent link">&para;</a></h2> <h3 id=ini-formaat>INI formaat<a class=headerlink href=#ini-formaat title="Permanent link">&para;</a></h3> <p>Traditsiooniline inventory formaat, sobiv lihtsamatele konfiguratsioonidele:</p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># Üksikud hostid</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=na>mail.example.com</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=na>web1.example.com</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=na>web2.example.com</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=c1># Hostide grupid</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=k>[webservers]</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=na>web1.example.com</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=na>web2.example.com</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=na>web3.example.com</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=k>[dbservers]</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=na>db1.example.com ansible_port</span><span class=o>=</span><span class=s>5432</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=na>db2.example.com ansible_port</span><span class=o>=</span><span class=s>5432</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=c1># Grupihierarhia</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=k>[production:children]</span>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=na>webservers</span>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=na>dbservers</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a>
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a><span class=c1># Grupi muutujad</span>
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class=k>[webservers:vars]</span>
</span><span id=__span-8-23><a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a><span class=na>http_port</span><span class=o>=</span><span class=s>80</span>
</span><span id=__span-8-24><a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a><span class=na>https_port</span><span class=o>=</span><span class=s>443</span>
</span><span id=__span-8-25><a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a><span class=na>nginx_user</span><span class=o>=</span><span class=s>www-data</span>
</span><span id=__span-8-26><a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a>
</span><span id=__span-8-27><a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a><span class=k>[dbservers:vars]</span>
</span><span id=__span-8-28><a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a><span class=na>db_port</span><span class=o>=</span><span class=s>3306</span>
</span><span id=__span-8-29><a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a><span class=na>db_user</span><span class=o>=</span><span class=s>admin</span>
</span></code></pre></div> <h3 id=yaml-formaat>YAML formaat<a class=headerlink href=#yaml-formaat title="Permanent link">&para;</a></h3> <p>Kaasaegne formaat, mis võimaldab keerulisemat struktureerimist:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=nt>all</span><span class=p>:</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>  </span><span class=nt>children</span><span class=p>:</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>    </span><span class=nt>webservers</span><span class=p>:</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>      </span><span class=nt>hosts</span><span class=p>:</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>        </span><span class=nt>web1.example.com</span><span class=p>:</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>          </span><span class=nt>ansible_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w>        </span><span class=nt>web2.example.com</span><span class=p>:</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>          </span><span class=nt>ansible_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>          </span><span class=nt>ansible_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2222</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=w>        </span><span class=nt>web3.example.com</span><span class=p>:</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=w>          </span><span class=nt>ansible_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">centos</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>      </span><span class=nt>vars</span><span class=p>:</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=w>        </span><span class=nt>http_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=w>        </span><span class=nt>https_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=w>        </span><span class=nt>nginx_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">www-data</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=w>    </span><span class=nt>dbservers</span><span class=p>:</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=w>      </span><span class=nt>hosts</span><span class=p>:</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=w>        </span><span class=nt>db1.example.com</span><span class=p>:</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a><span class=w>          </span><span class=nt>ansible_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=w>        </span><span class=nt>db2.example.com</span><span class=p>:</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=w>          </span><span class=nt>ansible_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a><span class=w>      </span><span class=nt>vars</span><span class=p>:</span>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a><span class=w>        </span><span class=nt>db_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
</span><span id=__span-9-25><a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a><span class=w>        </span><span class=nt>db_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
</span><span id=__span-9-26><a id=__codelineno-9-26 name=__codelineno-9-26 href=#__codelineno-9-26></a>
</span><span id=__span-9-27><a id=__codelineno-9-27 name=__codelineno-9-27 href=#__codelineno-9-27></a><span class=w>    </span><span class=nt>production</span><span class=p>:</span>
</span><span id=__span-9-28><a id=__codelineno-9-28 name=__codelineno-9-28 href=#__codelineno-9-28></a><span class=w>      </span><span class=nt>children</span><span class=p>:</span>
</span><span id=__span-9-29><a id=__codelineno-9-29 name=__codelineno-9-29 href=#__codelineno-9-29></a><span class=w>        </span><span class=nt>webservers</span><span class=p>:</span>
</span><span id=__span-9-30><a id=__codelineno-9-30 name=__codelineno-9-30 href=#__codelineno-9-30></a><span class=w>        </span><span class=nt>dbservers</span><span class=p>:</span>
</span></code></pre></div> <h3 id=dunaamiline-inventory>Dünaamiline inventory<a class=headerlink href=#dunaamiline-inventory title="Permanent link">&para;</a></h3> <p>Suurte või muutuvate infrastruktuuride jaoks võib implementeerida dünaamilise inventory genereerimise:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=ch>#!/usr/bin/env python3</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=k>def</span><span class=w> </span><span class=nf>get_inventory</span><span class=p>():</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Genereeri inventory välistest allikatest&quot;&quot;&quot;</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>    <span class=n>inventory</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>        <span class=s1>&#39;webservers&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>            <span class=s1>&#39;hosts&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>            <span class=s1>&#39;vars&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;http_port&#39;</span><span class=p>:</span> <span class=mi>80</span><span class=p>}</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>        <span class=p>},</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>        <span class=s1>&#39;dbservers&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>            <span class=s1>&#39;hosts&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>            <span class=s1>&#39;vars&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;db_port&#39;</span><span class=p>:</span> <span class=mi>3306</span><span class=p>}</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>        <span class=p>},</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>        <span class=s1>&#39;_meta&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>            <span class=s1>&#39;hostvars&#39;</span><span class=p>:</span> <span class=p>{}</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>        <span class=p>}</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a>    <span class=p>}</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a>    <span class=c1># Näide: loe serverid API-st</span>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a>    <span class=c1># servers = requests.get(&#39;https://api.company.com/servers&#39;).json()</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a>    <span class=c1># for server in servers:</span>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a>    <span class=c1>#     inventory[server[&#39;group&#39;]][&#39;hosts&#39;].append(server[&#39;hostname&#39;])</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a>    <span class=k>return</span> <span class=n>inventory</span>
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a>    <span class=nb>print</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>get_inventory</span><span class=p>(),</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>))</span>
</span></code></pre></div> <h2 id=ansible-konfigureerimine>Ansible konfigureerimine<a class=headerlink href=#ansible-konfigureerimine title="Permanent link">&para;</a></h2> <h3 id=ansiblecfg-faili-struktuur>ansible.cfg faili struktuur<a class=headerlink href=#ansiblecfg-faili-struktuur title="Permanent link">&para;</a></h3> <p>Ansible'i käitumist saab kohandada konfiguratsiooni faili abil. Soovitatav on hoida <code>ansible.cfg</code> faili projekti juurkaustas.</p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=k>[defaults]</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=c1># Inventory asukoht</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=na>inventory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>inventory/</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=c1># SSH seadistused</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=na>host_key_checking</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>False</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=na>remote_user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>ansible</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=na>private_key_file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>~/.ssh/ansible_ed25519</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=c1># Paralleelsuse seadistused</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=na>forks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>10</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=na>timeout</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>30</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=c1># Logimise seadistused</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=na>log_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>./ansible.log</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=na>display_skipped_hosts</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>False</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=c1># Callback pluginide konfigureerimine</span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=na>stdout_callback</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>yaml</span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=na>bin_ansible_callbacks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>True</span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a>
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=k>[ssh_connection]</span>
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a><span class=c1># SSH ühenduste optimeerimine</span>
</span><span id=__span-11-24><a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a><span class=na>ssh_args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>-o ControlMaster=auto -o ControlPersist=60s -o UserKnownHostsFile=/dev/null</span>
</span><span id=__span-11-25><a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a><span class=na>control_path_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>~/.ansible/cp</span>
</span><span id=__span-11-26><a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a><span class=na>pipelining</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>True</span>
</span><span id=__span-11-27><a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a><span class=na>retries</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>3</span>
</span><span id=__span-11-28><a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a>
</span><span id=__span-11-29><a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a><span class=k>[privilege_escalation]</span>
</span><span id=__span-11-30><a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a><span class=na>become</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>True</span>
</span><span id=__span-11-31><a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a><span class=na>become_method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>sudo</span>
</span><span id=__span-11-32><a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a><span class=na>become_user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>root</span>
</span><span id=__span-11-33><a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a><span class=na>become_ask_pass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>False</span>
</span></code></pre></div> <h3 id=konfiguratsiooni-prioriteet>Konfiguratsiooni prioriteet<a class=headerlink href=#konfiguratsiooni-prioriteet title="Permanent link">&para;</a></h3> <p>Ansible otsib konfiguratsiooni järgmises järjekorras:</p> <ol> <li><strong>ANSIBLE_CONFIG</strong> keskkonna muutuja</li> <li><strong>ansible.cfg</strong> praeguses töökaustas</li> <li><strong>~/.ansible.cfg</strong> kasutaja kodukaustas</li> <li><strong>/etc/ansible/ansible.cfg</strong> süsteemi tasemel</li> </ol> <p>Kehtiva konfiguratsiooni kontroll:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># Konfiguratsiooni vaatamine</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>ansible-config<span class=w> </span>view
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=c1># Kõikide parameetrite dump</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>ansible-config<span class=w> </span>dump
</span></code></pre></div> <h2 id=host-patterns-ja-sihtmarkide-valimine>Host patterns ja sihtmärkide valimine<a class=headerlink href=#host-patterns-ja-sihtmarkide-valimine title="Permanent link">&para;</a></h2> <p>Ansible võimaldab paindlikku serverite valimist erinevate mustrite abil:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1># Kõik hostid</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>ping
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=c1># Konkreetne grupp</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>ping
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=c1># Mitu gruppi</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>ansible<span class=w> </span>webservers:dbservers<span class=w> </span>-m<span class=w> </span>ping
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=c1># Välistamine</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>ansible<span class=w> </span>all:!dbservers<span class=w> </span>-m<span class=w> </span>ping
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=c1># Lõikumine</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a>ansible<span class=w> </span>webservers:<span class=p>&amp;</span>production<span class=w> </span>-m<span class=w> </span>ping
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=c1># Regulaaravaldised</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a>ansible<span class=w> </span>~web.*<span class=w> </span>-m<span class=w> </span>ping
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=c1># Vahemiku määramine</span>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a>ansible<span class=w> </span>web<span class=o>[</span><span class=m>1</span>:3<span class=o>]</span><span class=w> </span>-m<span class=w> </span>ping
</span></code></pre></div> <h2 id=uhenduse-diagnostika>Ühenduse diagnostika<a class=headerlink href=#uhenduse-diagnostika title="Permanent link">&para;</a></h2> <h3 id=pohilised-testid>Põhilised testid<a class=headerlink href=#pohilised-testid title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1># Ühenduvuse test</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>ping
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=c1># SSH ühenduse detailne test</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span><span class=nb>command</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;whoami&quot;</span><span class=w> </span>-vvv
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=c1># Süsteemi faktide kogumine</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>setup<span class=w> </span>--tree<span class=w> </span>/tmp/facts
</span></code></pre></div> <h3 id=tuupilised-probleemid-ja-lahendused>Tüüpilised probleemid ja lahendused<a class=headerlink href=#tuupilised-probleemid-ja-lahendused title="Permanent link">&para;</a></h3> <p><strong>SSH võtme probleemid:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=c1># Võtme õiguste kontroll</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>chmod<span class=w> </span><span class=m>600</span><span class=w> </span>~/.ssh/ansible_ed25519
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>chmod<span class=w> </span><span class=m>644</span><span class=w> </span>~/.ssh/ansible_ed25519.pub
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=c1># SSH agendi kontroll</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>ssh-add<span class=w> </span>-l
</span></code></pre></div></p> <p><strong>Host key verification:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c1># Ajutine keelamine</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=nb>export</span><span class=w> </span><span class=nv>ANSIBLE_HOST_KEY_CHECKING</span><span class=o>=</span>False
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=c1># Täielik keelamine</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;host_key_checking = False&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>ansible.cfg
</span></code></pre></div></p> <p><strong>Õiguste probleemid:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c1># Sudo konfiguratsiooni test</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span><span class=nb>command</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;sudo whoami&quot;</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=c1># Sudoers faili kontroll</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;sudo -l&quot;</span>
</span></code></pre></div></p> <h2 id=inventory-best-practices>Inventory best practices<a class=headerlink href=#inventory-best-practices title="Permanent link">&para;</a></h2> <h3 id=suurte-projektide-struktuur>Suurte projektide struktuur<a class=headerlink href=#suurte-projektide-struktuur title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>inventory/
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>├── production/
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>│   ├── hosts.yml
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>│   ├── group_vars/
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>│   │   ├── all/
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>│   │   │   ├── common.yml
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a>│   │   │   └── vault.yml
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>│   │   ├── webservers.yml
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>│   │   └── dbservers.yml
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a>│   └── host_vars/
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>│       ├── web1.example.com.yml
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>│       └── db1.example.com.yml
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a>├── staging/
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a>└── development/
</span></code></pre></div> <h3 id=muutujate-hierarhia>Muutujate hierarhia<a class=headerlink href=#muutujate-hierarhia title="Permanent link">&para;</a></h3> <p>Ansible muutujate prioriteet (kõrgem alistab madalam):</p> <ol> <li>Extra vars (<code>ansible-playbook -e</code>)</li> <li>Task vars</li> <li>Block vars</li> <li>Role ja include vars</li> <li>Play vars</li> <li>Host facts</li> <li>Host vars (inventory)</li> <li>Group vars (inventory)</li> <li>Group vars (all)</li> <li>Role defaults</li> </ol> <h3 id=turvalisuse-aspektid>Turvalisuse aspektid<a class=headerlink href=#turvalisuse-aspektid title="Permanent link">&para;</a></h3> <p>Tundliku informatsiooni kaitsmine Ansible Vault'iga:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1># Vault faili loomine</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>ansible-vault<span class=w> </span>create<span class=w> </span>group_vars/all/vault.yml
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=c1># Vault faili redigeerimine</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>ansible-vault<span class=w> </span>edit<span class=w> </span>group_vars/all/vault.yml
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=c1># Vault parooliga käivitamine</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>ansible-playbook<span class=w> </span>--ask-vault-pass<span class=w> </span>site.yml
</span></code></pre></div> <h2 id=kokkuvote_1>Kokkuvõte<a class=headerlink href=#kokkuvote_1 title="Permanent link">&para;</a></h2> <p>SSH võtme-põhine autentimine ja korrektselt struktureeritud inventory on Ansible automatiseerimise nurgakivid. Proper konfigureerimine tagab turvalisuse, skaleeritavuse ja hallatavuse. Järgmises peatükis käsitletakse ad-hoc käskude kasutamist operatiivsete ülesannete lahendamiseks.</p> <h1 id=23-ad-hoc-kaskude-kasutamine>2.3 Ad-hoc käskude kasutamine<a class=headerlink href=#23-ad-hoc-kaskude-kasutamine title="Permanent link">&para;</a></h1> <h2 id=ad-hoc-kaskude-olemus-ja-rakendusala>Ad-hoc käskude olemus ja rakendusala<a class=headerlink href=#ad-hoc-kaskude-olemus-ja-rakendusala title="Permanent link">&para;</a></h2> <p>Ad-hoc käsud on Ansible'i funktsioon, mis võimaldab käivitada ühekordse operatsioone otse käsurealt, ilma playbook'ide loomise vajaduseta. Need sobivad kiireteks uuringulisteks või diagnostilisteks toiminguteks.</p> <h3 id=kasutamise-stsenaariumid>Kasutamise stsenaariumid<a class=headerlink href=#kasutamise-stsenaariumid title="Permanent link">&para;</a></h3> <p><strong>Sobivad rakendused:</strong> - Süsteemi oleku kiire kontroll - Diagnostiliste andmete kogumine - Incident response operatsioonid - Eksploratiivsed uuringud - Monitoring ja alerting</p> <p><strong>Ebasobivad rakendused:</strong> - Keerulised mitme sammuga konfiguratsioonid - Regulaarsed hooldusoperatsioonid - Dokumenteerimist nõudvad protseduurid - Produktsiooni deployment'id</p> <h3 id=suntaksi-struktuur>Süntaksi struktuur<a class=headerlink href=#suntaksi-struktuur title="Permanent link">&para;</a></h3> <p>Ad-hoc käskude põhiline formaat:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>ansible<span class=w> </span>&lt;target&gt;<span class=w> </span>-m<span class=w> </span>&lt;module&gt;<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;&lt;arguments&gt;&quot;</span><span class=w> </span><span class=o>[</span>options<span class=o>]</span>
</span></code></pre></div> <p><strong>Komponendid:</strong> - <code>&lt;target&gt;</code> - inventory pattern või grupi nimi - <code>&lt;module&gt;</code> - kasutatav Ansible moodul - <code>&lt;arguments&gt;</code> - mooduli parameetrid - <code>[options]</code> - täiendavad käsulipud</p> <h2 id=pohilised-moodulid>Põhilised moodulid<a class=headerlink href=#pohilised-moodulid title="Permanent link">&para;</a></h2> <h3 id=ping-uhenduvuse-testimine>ping - Ühenduvuse testimine<a class=headerlink href=#ping-uhenduvuse-testimine title="Permanent link">&para;</a></h3> <p>Ping moodul kontrollib SSH ühenduvust ja Python interpreteri olemasolu:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1># Kõikide hostide test</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>ping
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=c1># Konkreetse grupi test</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>ping
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=c1># Pattern matching</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>ansible<span class=w> </span><span class=s1>&#39;web*&#39;</span><span class=w> </span>-m<span class=w> </span>ping
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=c1># Väljund tüüpilise eduka vastuse korral</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>ansible<span class=w> </span>web1.example.com<span class=w> </span>-m<span class=w> </span>ping
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=c1># web1.example.com | SUCCESS =&gt; {</span>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=c1>#     &quot;ansible_facts&quot;: {</span>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=c1>#         &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python3&quot;</span>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a><span class=c1>#     },</span>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a><span class=c1>#     &quot;changed&quot;: false,</span>
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a><span class=c1>#     &quot;ping&quot;: &quot;pong&quot;</span>
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a><span class=c1># }</span>
</span></code></pre></div> <h3 id=command-vs-shell-moodulid>command vs shell moodulid<a class=headerlink href=#command-vs-shell-moodulid title="Permanent link">&para;</a></h3> <h4 id=command-moodul>command moodul<a class=headerlink href=#command-moodul title="Permanent link">&para;</a></h4> <p>Turvalisem variant, mis ei luba shell'i funktsionaalsust:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># Süsteemi aja kuvamine</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span><span class=nb>command</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;date&quot;</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=c1># Protsesside loetelu</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span><span class=nb>command</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;ps aux&quot;</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=c1># Failisüsteemi statistika</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span><span class=nb>command</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;df -h&quot;</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=c1># Shell operaatorid EI tööta</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span><span class=nb>command</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;ps aux | grep nginx&quot;</span><span class=w>  </span><span class=c1># EBAÕNNESTUB</span>
</span></code></pre></div> <h4 id=shell-moodul>shell moodul<a class=headerlink href=#shell-moodul title="Permanent link">&para;</a></h4> <p>Võimaldab shell'i funktsionaalsust, kuid suurema turvariski hinnaga:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># Torudega käsud</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;ps aux | grep nginx&quot;</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=c1># Keskkonna muutujad</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;echo </span><span class=nv>$HOME</span><span class=s2>&quot;</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=c1># Käsu asendamine</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;kill </span><span class=k>$(</span>pgrep<span class=w> </span>-f<span class=w> </span>nginx<span class=k>)</span><span class=s2>&quot;</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=c1># Failide ümbersuunamine</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;dmesg | tail -20 &gt; /tmp/kernel.log&quot;</span>
</span></code></pre></div> <h3 id=package-tarkvarahaldus>package - Tarkvarahaldus<a class=headerlink href=#package-tarkvarahaldus title="Permanent link">&para;</a></h3> <p>Universaalne pakettide haldamise moodul:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># Ühe paketi installimine</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>package<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=htop state=present&quot;</span><span class=w> </span>--become
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=c1># Mitme paketi installimine</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>package<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=curl,wget,git state=present&quot;</span><span class=w> </span>--become
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=c1># Paketi eemaldamine</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>package<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=apache2 state=absent&quot;</span><span class=w> </span>--become
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=c1># Pakettide cache uuendamine (Debian/Ubuntu)</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a>ansible<span class=w> </span>ubuntu_hosts<span class=w> </span>-m<span class=w> </span>package<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;update_cache=yes&quot;</span><span class=w> </span>--become
</span></code></pre></div> <p>Spetsiifilised pakettide haldurid:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1># APT (Debian/Ubuntu)</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>ansible<span class=w> </span>ubuntu_hosts<span class=w> </span>-m<span class=w> </span>apt<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=nginx state=present update_cache=yes&quot;</span><span class=w> </span>--become
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=c1># YUM (RHEL/CentOS 7)</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>ansible<span class=w> </span>centos_hosts<span class=w> </span>-m<span class=w> </span>yum<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=nginx state=present&quot;</span><span class=w> </span>--become
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=c1># DNF (Fedora, RHEL 8+)</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a>ansible<span class=w> </span>fedora_hosts<span class=w> </span>-m<span class=w> </span>dnf<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=nginx state=present&quot;</span><span class=w> </span>--become
</span></code></pre></div> <h3 id=service-teenuste-haldamine>service - Teenuste haldamine<a class=headerlink href=#service-teenuste-haldamine title="Permanent link">&para;</a></h3> <p>Süsteemi teenuste kontroll:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=c1># Teenuse käivitamine</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>service<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=nginx state=started&quot;</span><span class=w> </span>--become
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=c1># Teenuse peatamine</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>service<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=apache2 state=stopped&quot;</span><span class=w> </span>--become
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=c1># Teenuse taaskäivitamine</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>service<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=nginx state=restarted&quot;</span><span class=w> </span>--become
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=c1># Autostart&#39;i lubamine</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>service<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=nginx enabled=yes&quot;</span><span class=w> </span>--become
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=c1># Kombineeritud operatsioon</span>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>service<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=nginx state=started enabled=yes&quot;</span><span class=w> </span>--become
</span></code></pre></div> <h3 id=file-failisusteemi-operatsioonid>file - Failisüsteemi operatsioonid<a class=headerlink href=#file-failisusteemi-operatsioonid title="Permanent link">&para;</a></h3> <p>Failide ja kataloogide haldamine:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1># Kataloogi loomine</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>file<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;path=/opt/application state=directory mode=0755&quot;</span><span class=w> </span>--become
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=c1># Faili loomine (touch)</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>file<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;path=/tmp/marker state=touch&quot;</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=c1># Õiguste muutmine</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>file<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;path=/etc/app.conf owner=app group=app mode=0640&quot;</span><span class=w> </span>--become
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=c1># Simbolilise lingi loomine</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>file<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;src=/usr/bin/python3 dest=/usr/bin/python state=link&quot;</span><span class=w> </span>--become
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=c1># Failide kustutamine</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>file<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;path=/tmp/tempfile state=absent&quot;</span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=c1># Rekursiivne õiguste määramine</span>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>file<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;path=/var/www state=directory owner=www-data group=www-data recurse=yes&quot;</span><span class=w> </span>--become
</span></code></pre></div> <h3 id=copy-failide-edastamine>copy - Failide edastamine<a class=headerlink href=#copy-failide-edastamine title="Permanent link">&para;</a></h3> <p>Sisu kopeerimine control node'st managed node'idesse:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1># Faili kopeerimine</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>copy<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;src=/local/config.conf dest=/etc/app/config.conf&quot;</span><span class=w> </span>--become
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=c1># Backup&#39;iga kopeerimine</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>copy<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;src=nginx.conf dest=/etc/nginx/nginx.conf backup=yes&quot;</span><span class=w> </span>--become
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=c1># Inline sisu loomine</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>copy<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;content=&#39;server_tokens off;&#39; dest=/etc/nginx/conf.d/security.conf&quot;</span><span class=w> </span>--become
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=c1># Õigustega kopeerimine</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>copy<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;src=script.sh dest=/usr/local/bin/script.sh mode=0755 owner=root&quot;</span><span class=w> </span>--become
</span></code></pre></div> <h2 id=susteemi-diagnostika>Süsteemi diagnostika<a class=headerlink href=#susteemi-diagnostika title="Permanent link">&para;</a></h2> <h3 id=riistvara-ja-susteemi-informatsioon>Riistvara ja süsteemi informatsioon<a class=headerlink href=#riistvara-ja-susteemi-informatsioon title="Permanent link">&para;</a></h3> <p>Setup moodul kogub põhjalikku informatsiooni hallatavate süsteemide kohta:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1># Operatsioonisüsteemi informatsioon</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>setup<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;filter=ansible_distribution*&quot;</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=c1># Mälu informatsioon</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>setup<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;filter=ansible_memory_mb&quot;</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=c1># Võrgu konfiguratsioon</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>setup<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;filter=ansible_default_ipv4&quot;</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=c1># CPU informatsioon</span>
</span><span id=__span-29-11><a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>setup<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;filter=ansible_processor*&quot;</span>
</span><span id=__span-29-12><a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a>
</span><span id=__span-29-13><a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=c1># Kettaruumi informatsioon</span>
</span><span id=__span-29-14><a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>setup<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;filter=ansible_mounts&quot;</span>
</span><span id=__span-29-15><a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a>
</span><span id=__span-29-16><a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a><span class=c1># Kõik faktid (mahukad andmed)</span>
</span><span id=__span-29-17><a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>setup<span class=w> </span>--tree<span class=w> </span>/tmp/facts/
</span></code></pre></div> <h3 id=performance-monitoring>Performance monitoring<a class=headerlink href=#performance-monitoring title="Permanent link">&para;</a></h3> <p>Süsteemi jõudluse kontroll:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=c1># Süsteemi koormus</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span><span class=nb>command</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;uptime&quot;</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=c1># Mälu kasutus</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;free -h&quot;</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=c1># Kettakasutus</span>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;df -h&quot;</span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=c1># Top protsessid CPU järgi</span>
</span><span id=__span-30-11><a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;ps aux --sort=-%cpu | head -10&quot;</span>
</span><span id=__span-30-12><a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a>
</span><span id=__span-30-13><a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=c1># Top protsessid mälu järgi</span>
</span><span id=__span-30-14><a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;ps aux --sort=-%mem | head -10&quot;</span>
</span><span id=__span-30-15><a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a>
</span><span id=__span-30-16><a id=__codelineno-30-16 name=__codelineno-30-16 href=#__codelineno-30-16></a><span class=c1># I/O statistika</span>
</span><span id=__span-30-17><a id=__codelineno-30-17 name=__codelineno-30-17 href=#__codelineno-30-17></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;iostat -x 1 1&quot;</span><span class=w> </span>
</span><span id=__span-30-18><a id=__codelineno-30-18 name=__codelineno-30-18 href=#__codelineno-30-18></a>
</span><span id=__span-30-19><a id=__codelineno-30-19 name=__codelineno-30-19 href=#__codelineno-30-19></a><span class=c1># Network statistika</span>
</span><span id=__span-30-20><a id=__codelineno-30-20 name=__codelineno-30-20 href=#__codelineno-30-20></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;ss -tuln&quot;</span>
</span></code></pre></div> <h3 id=logide-analuus>Logide analüüs<a class=headerlink href=#logide-analuus title="Permanent link">&para;</a></h3> <p>Süsteemi logide kiire uurimine:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=c1># Süsteemi logide viimaseid ridu</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;journalctl -n 20 --no-pager&quot;</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=c1># Specific teenuse logid</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;journalctl -u nginx -n 10 --no-pager&quot;</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=c1># Error&#39;ite otsimine</span>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;journalctl --since=&#39;1 hour ago&#39; -p err --no-pager&quot;</span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a>
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a><span class=c1># Kerneli sõnumid</span>
</span><span id=__span-31-11><a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;dmesg | tail -20&quot;</span>
</span><span id=__span-31-12><a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a>
</span><span id=__span-31-13><a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a><span class=c1># Faili-põhised logid</span>
</span><span id=__span-31-14><a id=__codelineno-31-14 name=__codelineno-31-14 href=#__codelineno-31-14></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;tail -20 /var/log/nginx/error.log&quot;</span>
</span></code></pre></div> <h2 id=tapsemad-operatsioonid>Täpsemad operatsioonid<a class=headerlink href=#tapsemad-operatsioonid title="Permanent link">&para;</a></h2> <h3 id=kasutajate-haldamine>Kasutajate haldamine<a class=headerlink href=#kasutajate-haldamine title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=c1># Kasutaja loomine</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>user<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=appuser shell=/bin/bash home=/home/appuser&quot;</span><span class=w> </span>--become
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=c1># Kasutaja grupi muutmine</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>user<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=appuser groups=sudo,www-data append=yes&quot;</span><span class=w> </span>--become
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=c1># SSH võtme lisamine</span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>authorized_key<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;user=appuser key=&#39;{{ lookup(&#39;file&#39;, &#39;~/.ssh/id_rsa.pub&#39;) }}&#39;&quot;</span><span class=w> </span>--become
</span></code></pre></div> <h3 id=vorgu-diagnostika>Võrgu diagnostika<a class=headerlink href=#vorgu-diagnostika title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1># Ühenduvuse test</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span><span class=nb>command</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;ping -c 3 google.com&quot;</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=c1># DNS lahendamine</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span><span class=nb>command</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;nslookup example.com&quot;</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=c1># Pordid kuulamas</span>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;netstat -tlnp&quot;</span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=c1># Aktiivsed ühendused</span>
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;ss -tupln&quot;</span>
</span></code></pre></div> <h2 id=kasurea-lipud-ja-optioonid>Käsurea lipud ja optioonid<a class=headerlink href=#kasurea-lipud-ja-optioonid title="Permanent link">&para;</a></h2> <h3 id=privilege-escalation>Privilege escalation<a class=headerlink href=#privilege-escalation title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=c1># Sudo kasutamine</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>package<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=htop state=present&quot;</span><span class=w> </span>--become
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=c1># Konkreetse kasutajana käivitamine</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span><span class=nb>command</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;whoami&quot;</span><span class=w> </span>--become-user<span class=o>=</span>postgres<span class=w> </span>--become
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a>
</span><span id=__span-34-7><a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a><span class=c1># Sudo meetodi määramine</span>
</span><span id=__span-34-8><a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span><span class=nb>command</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;id&quot;</span><span class=w> </span>--become-method<span class=o>=</span>su<span class=w> </span>--become
</span></code></pre></div> <h3 id=paralleelsuse-kontroll>Paralleelsuse kontroll<a class=headerlink href=#paralleelsuse-kontroll title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=c1># Järjestikune täitmine</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>ping<span class=w> </span>--forks<span class=o>=</span><span class=m>1</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a>
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=c1># Suurem paralleelsus</span>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>setup<span class=w> </span>--forks<span class=o>=</span><span class=m>20</span>
</span></code></pre></div> <h3 id=sihtmarkide-piiramine>Sihtmärkide piiramine<a class=headerlink href=#sihtmarkide-piiramine title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=c1># Pattern&#39;iga piiramine</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>ansible<span class=w> </span><span class=s1>&#39;web*&#39;</span><span class=w> </span>-m<span class=w> </span>ping
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=c1># Grupi välistamine</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a>ansible<span class=w> </span>all:!databases<span class=w> </span>-m<span class=w> </span><span class=nb>command</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;uptime&quot;</span>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=c1># Kombineeritud tingimused</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a>ansible<span class=w> </span>webservers:<span class=p>&amp;</span>production<span class=w> </span>-m<span class=w> </span>service<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=nginx state=restarted&quot;</span><span class=w> </span>--become
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a>
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a><span class=c1># Hosti limiteerimine</span>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a>ansible<span class=w> </span>all<span class=w> </span>--limit<span class=w> </span>web1.example.com,web2.example.com<span class=w> </span>-m<span class=w> </span>ping
</span></code></pre></div> <h3 id=kuiva-kaivitamise-reziim>Kuiva käivitamise režiim<a class=headerlink href=#kuiva-kaivitamise-reziim title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=c1># Kontroll ilma muudatusteta</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>package<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=nginx state=present&quot;</span><span class=w> </span>--check
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=c1># Muudatuste kuvamine</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>copy<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;src=test.conf dest=/etc/test.conf&quot;</span><span class=w> </span>--check<span class=w> </span>--diff
</span></code></pre></div> <h2 id=batch-operatsioonid>Batch operatsioonid<a class=headerlink href=#batch-operatsioonid title="Permanent link">&para;</a></h2> <h3 id=mitme-kasu-jarjestus>Mitme käsu järjestus<a class=headerlink href=#mitme-kasu-jarjestus title="Permanent link">&para;</a></h3> <p>Keerulisemate ülesannete jaoks võib kombineerida mitu ad-hoc käsku:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=ch>#!/bin/bash</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=c1># Veebiserveri kiire restart</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>service<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=nginx state=stopped&quot;</span><span class=w> </span>--become
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span><span class=nb>command</span><span class=w> </span>-a<span class=w> </span><span class=s2>&quot;sleep 5&quot;</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>service<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;name=nginx state=started&quot;</span><span class=w> </span>--become
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a>ansible<span class=w> </span>webservers<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;curl -I http://localhost&quot;</span><span class=w> </span>
</span></code></pre></div> <h3 id=informatsioon-kogumise-skript>Informatsioon kogumise skript<a class=headerlink href=#informatsioon-kogumise-skript title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=ch>#!/bin/bash</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=c1># Süsteemi auditi skript</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;=== System Information ===&quot;</span><span class=w> </span>&gt;<span class=w> </span>audit.log
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>setup<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;filter=ansible_distribution*&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>audit.log
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;=== Disk Usage ===&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>audit.log<span class=w>  </span>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;df -h&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>audit.log
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;=== Memory Usage ===&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>audit.log
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;free -h&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>audit.log
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;=== Running Services ===&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>audit.log
</span><span id=__span-39-10><a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a>ansible<span class=w> </span>all<span class=w> </span>-m<span class=w> </span>shell<span class=w> </span>-a<span class=w> </span><span class=s2>&quot;systemctl list-units --type=service --state=running --no-pager&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>audit.log
</span></code></pre></div> <h2 id=kokkuvote_2>Kokkuvõte<a class=headerlink href=#kokkuvote_2 title="Permanent link">&para;</a></h2> <p>Ad-hoc käsud pakuvad võimsat tööriista operatiivsete ülesannete lahendamiseks Ansible infrastruktuuris. Kuigi need sobivad hästi diagnostikaks ja lihtsateks operatsioonideks, keerulisema automatiseerimise jaoks tuleks kasutada playbook'e. Järgmises peatükis käsitletakse YAML süntaksit ja playbook'ide struktuuri.</p> <h1 id=24-yaml-suntaks-ja-playbookide-alused>2.4 YAML süntaks ja Playbook'ide alused<a class=headerlink href=#24-yaml-suntaks-ja-playbookide-alused title="Permanent link">&para;</a></h1> <h2 id=yaml-konfiguratsioonikeel>YAML konfiguratsioonikeel<a class=headerlink href=#yaml-konfiguratsioonikeel title="Permanent link">&para;</a></h2> <p>YAML (YAML Ain't Markup Language) on inimloetav andmete serialiseerimise standard, mida Ansible kasutab konfiguratsioonifailide ja playbook'ide kirjutamiseks. YAML-i eesmärk on pakkuda lihtsat ja intuitiivset süntaksit keeruliste andmestruktuuride kirjeldamiseks.</p> <h3 id=yaml-vs-alternatiivsed-formaadid>YAML vs alternatiivsed formaadid<a class=headerlink href=#yaml-vs-alternatiivsed-formaadid title="Permanent link">&para;</a></h3> <p><strong>YAML:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=nt>application</span><span class=p>:</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;web-service&quot;</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1.2.3&quot;</span>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=w>  </span><span class=nt>configuration</span><span class=p>:</span>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=w>    </span><span class=nt>debug</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id=__span-40-9><a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a><span class=w>    </span><span class=nt>max_connections</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
</span></code></pre></div></p> <p><strong>JSON ekvivalent:</strong> <div class="language-json highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=p>{</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=w>  </span><span class=nt>&quot;application&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=w>    </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;web-service&quot;</span><span class=p>,</span>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=w>    </span><span class=nt>&quot;version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;1.2.3&quot;</span><span class=p>,</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=w>    </span><span class=nt>&quot;ports&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=mi>80</span><span class=p>,</span><span class=w> </span><span class=mi>443</span><span class=p>],</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=w>    </span><span class=nt>&quot;configuration&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=w>      </span><span class=nt>&quot;debug&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=w>      </span><span class=nt>&quot;max_connections&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>1000</span>
</span><span id=__span-41-9><a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-41-10><a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-41-11><a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>XML ekvivalent:</strong> <div class="language-xml highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=nt>&lt;application&gt;</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=w>  </span><span class=nt>&lt;name&gt;</span>web-service<span class=nt>&lt;/name&gt;</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=w>  </span><span class=nt>&lt;version&gt;</span>1.2.3<span class=nt>&lt;/version&gt;</span>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=w>  </span><span class=nt>&lt;ports&gt;</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=w>    </span><span class=nt>&lt;port&gt;</span>80<span class=nt>&lt;/port&gt;</span>
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a><span class=w>    </span><span class=nt>&lt;port&gt;</span>443<span class=nt>&lt;/port&gt;</span>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=w>  </span><span class=nt>&lt;/ports&gt;</span>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a><span class=w>  </span><span class=nt>&lt;configuration&gt;</span>
</span><span id=__span-42-9><a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=w>    </span><span class=nt>&lt;debug&gt;</span>false<span class=nt>&lt;/debug&gt;</span>
</span><span id=__span-42-10><a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a><span class=w>    </span><span class=nt>&lt;max_connections&gt;</span>1000<span class=nt>&lt;/max_connections&gt;</span>
</span><span id=__span-42-11><a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=w>  </span><span class=nt>&lt;/configuration&gt;</span>
</span><span id=__span-42-12><a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=nt>&lt;/application&gt;</span>
</span></code></pre></div></p> <h2 id=yaml-suntaksi-reeglid>YAML süntaksi reeglid<a class=headerlink href=#yaml-suntaksi-reeglid title="Permanent link">&para;</a></h2> <h3 id=taandrimise-nouded>Taandrimise nõuded<a class=headerlink href=#taandrimise-nouded title="Permanent link">&para;</a></h3> <p>YAML kasutab taandrimist hierarhia määramiseks. Taandrimine peab olema järjekindel ja kasutama tühikuid:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=c1># Õige struktuur</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=nt>parent</span><span class=p>:</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=w>  </span><span class=nt>child1</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">value1</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=w>  </span><span class=nt>child2</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">value2</span>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=w>  </span><span class=nt>nested_parent</span><span class=p>:</span>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=w>    </span><span class=nt>nested_child</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nested_value</span>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a>
</span><span id=__span-43-8><a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=c1># Vale struktuur</span>
</span><span id=__span-43-9><a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=nt>parent</span><span class=p>:</span>
</span><span id=__span-43-10><a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=nt>child1</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">value1</span><span class=w>          </span><span class=c1># Vale tase</span>
</span><span id=__span-43-11><a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a><span class=w>  </span><span class=nt>child2</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">value2</span>
</span><span id=__span-43-12><a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">nested_parent</span><span class="p p-Indicator">:</span><span class=w>      </span><span class=c1># Inconsistent indentation</span>
</span><span id=__span-43-13><a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a><span class=w>  </span><span class=nt>nested_child</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">value</span><span class=w>   </span><span class=c1># Vale tase</span>
</span></code></pre></div> <h3 id=andmetuubid>Andmetüübid<a class=headerlink href=#andmetuubid title="Permanent link">&para;</a></h3> <p><strong>Skalaarid:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=nt>string_value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Hello</span><span class=nv> </span><span class=s>World&quot;</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=nt>integer_value</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">42</span>
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=nt>float_value</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3.14159</span>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=nt>boolean_true</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=nt>boolean_false</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id=__span-44-6><a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=nt>null_value</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span></code></pre></div></p> <p><strong>Loendid (Arrays):</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=c1># Kompaktne formaat</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=nt>fruits</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>apple</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>banana</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>orange</span><span class="p p-Indicator">]</span>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=c1># Laiendatud formaat</span>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=nt>fruits</span><span class=p>:</span>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apple</span>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">banana</span>
</span><span id=__span-45-8><a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">orange</span>
</span><span id=__span-45-9><a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a>
</span><span id=__span-45-10><a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=c1># Objektide loend</span>
</span><span id=__span-45-11><a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a><span class=nt>servers</span><span class=p>:</span>
</span><span id=__span-45-12><a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web1</span>
</span><span id=__span-45-13><a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a><span class=w>    </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.10</span>
</span><span id=__span-45-14><a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web2</span>
</span><span id=__span-45-15><a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a><span class=w>    </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.11</span>
</span></code></pre></div></p> <p><strong>Võtme-väärtuse paarid (Dictionaries):</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=nt>server_config</span><span class=p>:</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=w>  </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web1.example.com</span>
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=w>  </span><span class=nt>ssl_enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=w>  </span><span class=nt>allowed_ips</span><span class=p>:</span>
</span><span id=__span-46-6><a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.0/24</span>
</span><span id=__span-46-7><a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10.0.0.0/8</span>
</span></code></pre></div></p> <h3 id=mitme-rea-stringid>Mitme rea stringid<a class=headerlink href=#mitme-rea-stringid title="Permanent link">&para;</a></h3> <p><strong>Literal style (|) - säilitab reavahetused:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=w>  </span><span class=no>See on pikk kirjeldus,</span>
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=w>  </span><span class=no>mis sisaldab mitut rida</span>
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=w>  </span><span class=no>ja säilitab kõik reavahetused.</span>
</span></code></pre></div></p> <p><strong>Folded style (&gt;) - ühendab ridadeks:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">&gt;</span>
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=w>  </span><span class=no>See tekst kirjutatakse</span>
</span><span id=__span-48-3><a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=w>  </span><span class=no>mitmel real, aga tulemuseks</span>
</span><span id=__span-48-4><a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=w>  </span><span class=no>on üks pikk rida.</span>
</span></code></pre></div></p> <h2 id=playbookide-struktuur>Playbook'ide struktuur<a class=headerlink href=#playbookide-struktuur title="Permanent link">&para;</a></h2> <h3 id=playbooki-anatoomia>Playbook'i anatoomia<a class=headerlink href=#playbooki-anatoomia title="Permanent link">&para;</a></h3> <p>Playbook koosneb ühest või mitmest "play'st", mis on suunatud konkreetsetele hostidele:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=nn>---</span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Esimene</span><span class=nv> </span><span class=s>play</span><span class=nv> </span><span class=s>-</span><span class=nv> </span><span class=s>veebiserveri</span><span class=nv> </span><span class=s>seadistamine&quot;</span>
</span><span id=__span-49-3><a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
</span><span id=__span-49-4><a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id=__span-49-5><a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a><span class=w>  </span><span class=nt>vars</span><span class=p>:</span>
</span><span id=__span-49-6><a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=w>    </span><span class=nt>http_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id=__span-49-7><a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=w>    </span><span class=nt>server_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
</span><span id=__span-49-8><a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a>
</span><span id=__span-49-9><a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span>
</span><span id=__span-49-10><a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Nginx&#39;i</span><span class=nv> </span><span class=s>installimine&quot;</span>
</span><span id=__span-49-11><a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a><span class=w>      </span><span class=nt>package</span><span class=p>:</span>
</span><span id=__span-49-12><a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id=__span-49-13><a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id=__span-49-14><a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a>
</span><span id=__span-49-15><a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Teine</span><span class=nv> </span><span class=s>play</span><span class=nv> </span><span class=s>-</span><span class=nv> </span><span class=s>andmebaasi</span><span class=nv> </span><span class=s>seadistamine&quot;</span><span class=w>  </span>
</span><span id=__span-49-16><a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dbservers</span>
</span><span id=__span-49-17><a id=__codelineno-49-17 name=__codelineno-49-17 href=#__codelineno-49-17></a><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id=__span-49-18><a id=__codelineno-49-18 name=__codelineno-49-18 href=#__codelineno-49-18></a>
</span><span id=__span-49-19><a id=__codelineno-49-19 name=__codelineno-49-19 href=#__codelineno-49-19></a><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span>
</span><span id=__span-49-20><a id=__codelineno-49-20 name=__codelineno-49-20 href=#__codelineno-49-20></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;MySQL</span><span class=nv> </span><span class=s>installimine&quot;</span>
</span><span id=__span-49-21><a id=__codelineno-49-21 name=__codelineno-49-21 href=#__codelineno-49-21></a><span class=w>      </span><span class=nt>package</span><span class=p>:</span>
</span><span id=__span-49-22><a id=__codelineno-49-22 name=__codelineno-49-22 href=#__codelineno-49-22></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysql-server</span>
</span><span id=__span-49-23><a id=__codelineno-49-23 name=__codelineno-49-23 href=#__codelineno-49-23></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span></code></pre></div> <h3 id=play-komponendid>Play komponendid<a class=headerlink href=#play-komponendid title="Permanent link">&para;</a></h3> <h4 id=hosts-directive>Hosts directive<a class=headerlink href=#hosts-directive title="Permanent link">&para;</a></h4> <p>Määrab sihtmärgid, kus play käivitatakse:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">all</span><span class=w>                    </span><span class=c1># Kõik inventory hostid</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span><span class=w>            </span><span class=c1># Konkreetne grupp</span>
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web*.example.com</span><span class=w>      </span><span class=c1># Pattern matching</span>
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">webservers:dbservers</span><span class=w>  </span><span class=c1># Mitme grupi kombinatsioon</span>
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">all:!production</span><span class=w>       </span><span class=c1># Välistamisega</span>
</span></code></pre></div> <h4 id=variables>Variables<a class=headerlink href=#variables title="Permanent link">&para;</a></h4> <p>Muutujate defineerimine play tasemel:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=nt>vars</span><span class=p>:</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=w>  </span><span class=nt>app_name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;myapp&quot;</span>
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=w>  </span><span class=nt>app_version</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2.1.0&quot;</span>
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=w>  </span><span class=nt>app_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id=__span-51-5><a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=w>  </span><span class=nt>app_users</span><span class=p>:</span>
</span><span id=__span-51-6><a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
</span><span id=__span-51-7><a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">operator</span>
</span><span id=__span-51-8><a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a><span class=w>  </span><span class=nt>app_config</span><span class=p>:</span>
</span><span id=__span-51-9><a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=w>    </span><span class=nt>debug</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id=__span-51-10><a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
</span></code></pre></div> <h4 id=tasks>Tasks<a class=headerlink href=#tasks title="Permanent link">&para;</a></h4> <p>Ülesannete loend, mis täidetakse järjekorras:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=nt>tasks</span><span class=p>:</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Lühike,</span><span class=nv> </span><span class=s>kirjeldav</span><span class=nv> </span><span class=s>ülesande</span><span class=nv> </span><span class=s>nimi&quot;</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=w>    </span><span class=nt>module_name</span><span class=p>:</span>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=w>      </span><span class=nt>parameter1</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">value1</span>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=w>      </span><span class=nt>parameter2</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">value2</span>
</span><span id=__span-52-6><a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=w>    </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">condition</span>
</span><span id=__span-52-7><a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=w>    </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>tag1</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>tag2</span><span class="p p-Indicator">]</span>
</span></code></pre></div> <h2 id=muutujate-kasutamine>Muutujate kasutamine<a class=headerlink href=#muutujate-kasutamine title="Permanent link">&para;</a></h2> <h3 id=muutujate-interpoleerimine>Muutujate interpoleerimine<a class=headerlink href=#muutujate-interpoleerimine title="Permanent link">&para;</a></h3> <p>YAML-is kasutatakse Jinja2 template süntaksit muutujate asendamiseks:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Rakenduse</span><span class=nv> </span><span class=s>seadistamine&quot;</span>
</span><span id=__span-53-2><a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
</span><span id=__span-53-3><a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=w>  </span><span class=nt>vars</span><span class=p>:</span>
</span><span id=__span-53-4><a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=w>    </span><span class=nt>app_name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;webstore&quot;</span>
</span><span id=__span-53-5><a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=w>    </span><span class=nt>app_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id=__span-53-6><a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=w>    </span><span class=nt>config_path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/etc/{{</span><span class=nv> </span><span class=s>app_name</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-53-7><a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a>
</span><span id=__span-53-8><a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span>
</span><span id=__span-53-9><a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Loo</span><span class=nv> </span><span class=s>konfiguratsioonikaust</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>config_path</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-53-10><a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a><span class=w>      </span><span class=nt>file</span><span class=p>:</span>
</span><span id=__span-53-11><a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>config_path</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-53-12><a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
</span><span id=__span-53-13><a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0755&#39;</span>
</span><span id=__span-53-14><a id=__codelineno-53-14 name=__codelineno-53-14 href=#__codelineno-53-14></a>
</span><span id=__span-53-15><a id=__codelineno-53-15 name=__codelineno-53-15 href=#__codelineno-53-15></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Genereeri</span><span class=nv> </span><span class=s>konfiguratsioonifail&quot;</span>
</span><span id=__span-53-16><a id=__codelineno-53-16 name=__codelineno-53-16 href=#__codelineno-53-16></a><span class=w>      </span><span class=nt>copy</span><span class=p>:</span>
</span><span id=__span-53-17><a id=__codelineno-53-17 name=__codelineno-53-17 href=#__codelineno-53-17></a><span class=w>        </span><span class=nt>content</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-53-18><a id=__codelineno-53-18 name=__codelineno-53-18 href=#__codelineno-53-18></a><span class=w>          </span><span class=no>[application]</span>
</span><span id=__span-53-19><a id=__codelineno-53-19 name=__codelineno-53-19 href=#__codelineno-53-19></a><span class=w>          </span><span class=no>name={{ app_name }}</span>
</span><span id=__span-53-20><a id=__codelineno-53-20 name=__codelineno-53-20 href=#__codelineno-53-20></a><span class=w>          </span><span class=no>port={{ app_port }}</span>
</span><span id=__span-53-21><a id=__codelineno-53-21 name=__codelineno-53-21 href=#__codelineno-53-21></a><span class=w>          </span><span class=no>debug=false</span>
</span><span id=__span-53-22><a id=__codelineno-53-22 name=__codelineno-53-22 href=#__codelineno-53-22></a><span class=w>        </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>config_path</span><span class=nv> </span><span class=s>}}/app.conf&quot;</span>
</span></code></pre></div> <h3 id=muutujate-allikad>Muutujate allikad<a class=headerlink href=#muutujate-allikad title="Permanent link">&para;</a></h3> <p>Ansible võtab muutujaid mitmest allikast hierarhilises järjekorras:</p> <ol> <li>Extra vars (<code>-e</code> käsureal)</li> <li>Task variables</li> <li>Block variables </li> <li>Role variables</li> <li>Play variables</li> <li>Host facts</li> <li>Host variables</li> <li>Group variables</li> <li>Default variables</li> </ol> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=c1># group_vars/webservers.yml</span>
</span><span id=__span-54-2><a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=nt>nginx_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id=__span-54-3><a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=nt>nginx_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">www-data</span>
</span><span id=__span-54-4><a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=nt>ssl_certificate</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/etc/ssl/certs/{{</span><span class=nv> </span><span class=s>ansible_fqdn</span><span class=nv> </span><span class=s>}}.crt&quot;</span>
</span><span id=__span-54-5><a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a>
</span><span id=__span-54-6><a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a><span class=c1># host_vars/web1.example.com.yml  </span>
</span><span id=__span-54-7><a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a><span class=nt>nginx_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id=__span-54-8><a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a><span class=nt>custom_config</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div> <h2 id=handlers-susteem>Handlers süsteem<a class=headerlink href=#handlers-susteem title="Permanent link">&para;</a></h2> <p>Handlers on erikülesanded, mis käivitatakse ainult notification'i peale ja alles play lõpus:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Nginx&#39;i</span><span class=nv> </span><span class=s>konfigureerimine&quot;</span>
</span><span id=__span-55-2><a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
</span><span id=__span-55-3><a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id=__span-55-4><a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a>
</span><span id=__span-55-5><a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span>
</span><span id=__span-55-6><a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Nginx</span><span class=nv> </span><span class=s>põhikonfiguratsiooni</span><span class=nv> </span><span class=s>uuendamine&quot;</span>
</span><span id=__span-55-7><a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=w>      </span><span class=nt>template</span><span class=p>:</span>
</span><span id=__span-55-8><a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=w>        </span><span class=nt>src</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
</span><span id=__span-55-9><a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a><span class=w>        </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
</span><span id=__span-55-10><a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a><span class=w>      </span><span class=nt>notify</span><span class=p>:</span>
</span><span id=__span-55-11><a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart nginx</span>
</span><span id=__span-55-12><a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">reload systemd</span>
</span><span id=__span-55-13><a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a>
</span><span id=__span-55-14><a id=__codelineno-55-14 name=__codelineno-55-14 href=#__codelineno-55-14></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;SSL</span><span class=nv> </span><span class=s>sertifikaadi</span><span class=nv> </span><span class=s>paigaldamine&quot;</span>
</span><span id=__span-55-15><a id=__codelineno-55-15 name=__codelineno-55-15 href=#__codelineno-55-15></a><span class=w>      </span><span class=nt>copy</span><span class=p>:</span>
</span><span id=__span-55-16><a id=__codelineno-55-16 name=__codelineno-55-16 href=#__codelineno-55-16></a><span class=w>        </span><span class=nt>src</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>ssl_cert_file</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-55-17><a id=__codelineno-55-17 name=__codelineno-55-17 href=#__codelineno-55-17></a><span class=w>        </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/certs/nginx.crt</span>
</span><span id=__span-55-18><a id=__codelineno-55-18 name=__codelineno-55-18 href=#__codelineno-55-18></a><span class=w>      </span><span class=nt>notify</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart nginx</span>
</span><span id=__span-55-19><a id=__codelineno-55-19 name=__codelineno-55-19 href=#__codelineno-55-19></a>
</span><span id=__span-55-20><a id=__codelineno-55-20 name=__codelineno-55-20 href=#__codelineno-55-20></a><span class=w>  </span><span class=nt>handlers</span><span class=p>:</span>
</span><span id=__span-55-21><a id=__codelineno-55-21 name=__codelineno-55-21 href=#__codelineno-55-21></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart nginx</span>
</span><span id=__span-55-22><a id=__codelineno-55-22 name=__codelineno-55-22 href=#__codelineno-55-22></a><span class=w>      </span><span class=nt>service</span><span class=p>:</span>
</span><span id=__span-55-23><a id=__codelineno-55-23 name=__codelineno-55-23 href=#__codelineno-55-23></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id=__span-55-24><a id=__codelineno-55-24 name=__codelineno-55-24 href=#__codelineno-55-24></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</span><span id=__span-55-25><a id=__codelineno-55-25 name=__codelineno-55-25 href=#__codelineno-55-25></a>
</span><span id=__span-55-26><a id=__codelineno-55-26 name=__codelineno-55-26 href=#__codelineno-55-26></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">reload systemd</span>
</span><span id=__span-55-27><a id=__codelineno-55-27 name=__codelineno-55-27 href=#__codelineno-55-27></a><span class=w>      </span><span class=nt>systemd</span><span class=p>:</span>
</span><span id=__span-55-28><a id=__codelineno-55-28 name=__codelineno-55-28 href=#__codelineno-55-28></a><span class=w>        </span><span class=nt>daemon_reload</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span></code></pre></div> <p>Handler'i käitumise reeglid: - Käivitatakse ainult notification'i korral - Käivitatakse play lõpus isegi siis, kui mitu task'i sama handler'it notify'ib - Ei käivitata, kui task ebaõnnestub (v.a force_handlers: yes)</p> <h2 id=praktiline-naide-lamp-stack>Praktiline näide: LAMP stack<a class=headerlink href=#praktiline-naide-lamp-stack title="Permanent link">&para;</a></h2> <p>Kompleksne playbook veebiserveri infrastruktuuri seadistamiseks:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-56-1><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=nn>---</span>
</span><span id=__span-56-2><a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;LAMP</span><span class=nv> </span><span class=s>stack&#39;i</span><span class=nv> </span><span class=s>paigaldamine</span><span class=nv> </span><span class=s>ja</span><span class=nv> </span><span class=s>konfigureerimine&quot;</span>
</span><span id=__span-56-3><a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
</span><span id=__span-56-4><a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id=__span-56-5><a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=w>  </span><span class=nt>vars</span><span class=p>:</span>
</span><span id=__span-56-6><a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a><span class=w>    </span><span class=nt>mysql_root_password</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>vault_mysql_root_password</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-56-7><a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a><span class=w>    </span><span class=nt>app_database</span><span class=p>:</span><span class=w> </span><span class=s>&quot;webapp_db&quot;</span>
</span><span id=__span-56-8><a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a><span class=w>    </span><span class=nt>app_user</span><span class=p>:</span><span class=w> </span><span class=s>&quot;webapp_user&quot;</span>
</span><span id=__span-56-9><a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a><span class=w>    </span><span class=nt>app_password</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>vault_app_password</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-56-10><a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a><span class=w>    </span><span class=nt>web_root</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/www/html&quot;</span>
</span><span id=__span-56-11><a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a><span class=w>    </span><span class=nt>php_packages</span><span class=p>:</span>
</span><span id=__span-56-12><a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">php</span>
</span><span id=__span-56-13><a id=__codelineno-56-13 name=__codelineno-56-13 href=#__codelineno-56-13></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">php-mysql</span>
</span><span id=__span-56-14><a id=__codelineno-56-14 name=__codelineno-56-14 href=#__codelineno-56-14></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">php-curl</span>
</span><span id=__span-56-15><a id=__codelineno-56-15 name=__codelineno-56-15 href=#__codelineno-56-15></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">php-gd</span>
</span><span id=__span-56-16><a id=__codelineno-56-16 name=__codelineno-56-16 href=#__codelineno-56-16></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">libapache2-mod-php</span>
</span><span id=__span-56-17><a id=__codelineno-56-17 name=__codelineno-56-17 href=#__codelineno-56-17></a>
</span><span id=__span-56-18><a id=__codelineno-56-18 name=__codelineno-56-18 href=#__codelineno-56-18></a><span class=w>  </span><span class=nt>pre_tasks</span><span class=p>:</span>
</span><span id=__span-56-19><a id=__codelineno-56-19 name=__codelineno-56-19 href=#__codelineno-56-19></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Süsteemi</span><span class=nv> </span><span class=s>uuendamine&quot;</span>
</span><span id=__span-56-20><a id=__codelineno-56-20 name=__codelineno-56-20 href=#__codelineno-56-20></a><span class=w>      </span><span class=nt>package</span><span class=p>:</span>
</span><span id=__span-56-21><a id=__codelineno-56-21 name=__codelineno-56-21 href=#__codelineno-56-21></a><span class=w>        </span><span class=nt>update_cache</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id=__span-56-22><a id=__codelineno-56-22 name=__codelineno-56-22 href=#__codelineno-56-22></a><span class=w>        </span><span class=nt>upgrade</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dist</span>
</span><span id=__span-56-23><a id=__codelineno-56-23 name=__codelineno-56-23 href=#__codelineno-56-23></a>
</span><span id=__span-56-24><a id=__codelineno-56-24 name=__codelineno-56-24 href=#__codelineno-56-24></a><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span>
</span><span id=__span-56-25><a id=__codelineno-56-25 name=__codelineno-56-25 href=#__codelineno-56-25></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Apache</span><span class=nv> </span><span class=s>veebiserveri</span><span class=nv> </span><span class=s>installimine&quot;</span>
</span><span id=__span-56-26><a id=__codelineno-56-26 name=__codelineno-56-26 href=#__codelineno-56-26></a><span class=w>      </span><span class=nt>package</span><span class=p>:</span>
</span><span id=__span-56-27><a id=__codelineno-56-27 name=__codelineno-56-27 href=#__codelineno-56-27></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apache2</span>
</span><span id=__span-56-28><a id=__codelineno-56-28 name=__codelineno-56-28 href=#__codelineno-56-28></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id=__span-56-29><a id=__codelineno-56-29 name=__codelineno-56-29 href=#__codelineno-56-29></a><span class=w>      </span><span class=nt>notify</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">enable apache</span>
</span><span id=__span-56-30><a id=__codelineno-56-30 name=__codelineno-56-30 href=#__codelineno-56-30></a>
</span><span id=__span-56-31><a id=__codelineno-56-31 name=__codelineno-56-31 href=#__codelineno-56-31></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;MySQL</span><span class=nv> </span><span class=s>serveri</span><span class=nv> </span><span class=s>installimine&quot;</span>
</span><span id=__span-56-32><a id=__codelineno-56-32 name=__codelineno-56-32 href=#__codelineno-56-32></a><span class=w>      </span><span class=nt>package</span><span class=p>:</span>
</span><span id=__span-56-33><a id=__codelineno-56-33 name=__codelineno-56-33 href=#__codelineno-56-33></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span>
</span><span id=__span-56-34><a id=__codelineno-56-34 name=__codelineno-56-34 href=#__codelineno-56-34></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysql-server</span>
</span><span id=__span-56-35><a id=__codelineno-56-35 name=__codelineno-56-35 href=#__codelineno-56-35></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">python3-pymysql</span>
</span><span id=__span-56-36><a id=__codelineno-56-36 name=__codelineno-56-36 href=#__codelineno-56-36></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id=__span-56-37><a id=__codelineno-56-37 name=__codelineno-56-37 href=#__codelineno-56-37></a><span class=w>      </span><span class=nt>notify</span><span class=p>:</span><span class=w> </span>
</span><span id=__span-56-38><a id=__codelineno-56-38 name=__codelineno-56-38 href=#__codelineno-56-38></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">start mysql</span>
</span><span id=__span-56-39><a id=__codelineno-56-39 name=__codelineno-56-39 href=#__codelineno-56-39></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secure mysql</span>
</span><span id=__span-56-40><a id=__codelineno-56-40 name=__codelineno-56-40 href=#__codelineno-56-40></a>
</span><span id=__span-56-41><a id=__codelineno-56-41 name=__codelineno-56-41 href=#__codelineno-56-41></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;PHP</span><span class=nv> </span><span class=s>ja</span><span class=nv> </span><span class=s>moodulite</span><span class=nv> </span><span class=s>installimine&quot;</span>
</span><span id=__span-56-42><a id=__codelineno-56-42 name=__codelineno-56-42 href=#__codelineno-56-42></a><span class=w>      </span><span class=nt>package</span><span class=p>:</span>
</span><span id=__span-56-43><a id=__codelineno-56-43 name=__codelineno-56-43 href=#__codelineno-56-43></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>php_packages</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-56-44><a id=__codelineno-56-44 name=__codelineno-56-44 href=#__codelineno-56-44></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id=__span-56-45><a id=__codelineno-56-45 name=__codelineno-56-45 href=#__codelineno-56-45></a><span class=w>      </span><span class=nt>notify</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart apache</span>
</span><span id=__span-56-46><a id=__codelineno-56-46 name=__codelineno-56-46 href=#__codelineno-56-46></a>
</span><span id=__span-56-47><a id=__codelineno-56-47 name=__codelineno-56-47 href=#__codelineno-56-47></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Apache</span><span class=nv> </span><span class=s>moodulite</span><span class=nv> </span><span class=s>lubamine&quot;</span>
</span><span id=__span-56-48><a id=__codelineno-56-48 name=__codelineno-56-48 href=#__codelineno-56-48></a><span class=w>      </span><span class=nt>apache2_module</span><span class=p>:</span>
</span><span id=__span-56-49><a id=__codelineno-56-49 name=__codelineno-56-49 href=#__codelineno-56-49></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>item</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-56-50><a id=__codelineno-56-50 name=__codelineno-56-50 href=#__codelineno-56-50></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id=__span-56-51><a id=__codelineno-56-51 name=__codelineno-56-51 href=#__codelineno-56-51></a><span class=w>      </span><span class=nt>loop</span><span class=p>:</span>
</span><span id=__span-56-52><a id=__codelineno-56-52 name=__codelineno-56-52 href=#__codelineno-56-52></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rewrite</span>
</span><span id=__span-56-53><a id=__codelineno-56-53 name=__codelineno-56-53 href=#__codelineno-56-53></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ssl</span>
</span><span id=__span-56-54><a id=__codelineno-56-54 name=__codelineno-56-54 href=#__codelineno-56-54></a><span class=w>      </span><span class=nt>notify</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart apache</span>
</span><span id=__span-56-55><a id=__codelineno-56-55 name=__codelineno-56-55 href=#__codelineno-56-55></a>
</span><span id=__span-56-56><a id=__codelineno-56-56 name=__codelineno-56-56 href=#__codelineno-56-56></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Rakenduse</span><span class=nv> </span><span class=s>kataloogi</span><span class=nv> </span><span class=s>loomine&quot;</span>
</span><span id=__span-56-57><a id=__codelineno-56-57 name=__codelineno-56-57 href=#__codelineno-56-57></a><span class=w>      </span><span class=nt>file</span><span class=p>:</span>
</span><span id=__span-56-58><a id=__codelineno-56-58 name=__codelineno-56-58 href=#__codelineno-56-58></a><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>web_root</span><span class=nv> </span><span class=s>}}/{{</span><span class=nv> </span><span class=s>app_database</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-56-59><a id=__codelineno-56-59 name=__codelineno-56-59 href=#__codelineno-56-59></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
</span><span id=__span-56-60><a id=__codelineno-56-60 name=__codelineno-56-60 href=#__codelineno-56-60></a><span class=w>        </span><span class=nt>owner</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">www-data</span>
</span><span id=__span-56-61><a id=__codelineno-56-61 name=__codelineno-56-61 href=#__codelineno-56-61></a><span class=w>        </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">www-data</span>
</span><span id=__span-56-62><a id=__codelineno-56-62 name=__codelineno-56-62 href=#__codelineno-56-62></a><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0755&#39;</span>
</span><span id=__span-56-63><a id=__codelineno-56-63 name=__codelineno-56-63 href=#__codelineno-56-63></a>
</span><span id=__span-56-64><a id=__codelineno-56-64 name=__codelineno-56-64 href=#__codelineno-56-64></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;PHP</span><span class=nv> </span><span class=s>test</span><span class=nv> </span><span class=s>lehe</span><span class=nv> </span><span class=s>loomine&quot;</span>
</span><span id=__span-56-65><a id=__codelineno-56-65 name=__codelineno-56-65 href=#__codelineno-56-65></a><span class=w>      </span><span class=nt>template</span><span class=p>:</span>
</span><span id=__span-56-66><a id=__codelineno-56-66 name=__codelineno-56-66 href=#__codelineno-56-66></a><span class=w>        </span><span class=nt>src</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">index.php.j2</span>
</span><span id=__span-56-67><a id=__codelineno-56-67 name=__codelineno-56-67 href=#__codelineno-56-67></a><span class=w>        </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>web_root</span><span class=nv> </span><span class=s>}}/index.php&quot;</span>
</span><span id=__span-56-68><a id=__codelineno-56-68 name=__codelineno-56-68 href=#__codelineno-56-68></a><span class=w>        </span><span class=nt>owner</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">www-data</span>
</span><span id=__span-56-69><a id=__codelineno-56-69 name=__codelineno-56-69 href=#__codelineno-56-69></a><span class=w>        </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">www-data</span>
</span><span id=__span-56-70><a id=__codelineno-56-70 name=__codelineno-56-70 href=#__codelineno-56-70></a><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0644&#39;</span>
</span><span id=__span-56-71><a id=__codelineno-56-71 name=__codelineno-56-71 href=#__codelineno-56-71></a>
</span><span id=__span-56-72><a id=__codelineno-56-72 name=__codelineno-56-72 href=#__codelineno-56-72></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;MySQL</span><span class=nv> </span><span class=s>root</span><span class=nv> </span><span class=s>parooli</span><span class=nv> </span><span class=s>seadistamine&quot;</span>
</span><span id=__span-56-73><a id=__codelineno-56-73 name=__codelineno-56-73 href=#__codelineno-56-73></a><span class=w>      </span><span class=nt>mysql_user</span><span class=p>:</span>
</span><span id=__span-56-74><a id=__codelineno-56-74 name=__codelineno-56-74 href=#__codelineno-56-74></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id=__span-56-75><a id=__codelineno-56-75 name=__codelineno-56-75 href=#__codelineno-56-75></a><span class=w>        </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>mysql_root_password</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-56-76><a id=__codelineno-56-76 name=__codelineno-56-76 href=#__codelineno-56-76></a><span class=w>        </span><span class=nt>login_unix_socket</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/mysqld/mysqld.sock</span>
</span><span id=__span-56-77><a id=__codelineno-56-77 name=__codelineno-56-77 href=#__codelineno-56-77></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id=__span-56-78><a id=__codelineno-56-78 name=__codelineno-56-78 href=#__codelineno-56-78></a>
</span><span id=__span-56-79><a id=__codelineno-56-79 name=__codelineno-56-79 href=#__codelineno-56-79></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Rakenduse</span><span class=nv> </span><span class=s>andmebaasi</span><span class=nv> </span><span class=s>loomine&quot;</span>
</span><span id=__span-56-80><a id=__codelineno-56-80 name=__codelineno-56-80 href=#__codelineno-56-80></a><span class=w>      </span><span class=nt>mysql_db</span><span class=p>:</span>
</span><span id=__span-56-81><a id=__codelineno-56-81 name=__codelineno-56-81 href=#__codelineno-56-81></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>app_database</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-56-82><a id=__codelineno-56-82 name=__codelineno-56-82 href=#__codelineno-56-82></a><span class=w>        </span><span class=nt>login_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id=__span-56-83><a id=__codelineno-56-83 name=__codelineno-56-83 href=#__codelineno-56-83></a><span class=w>        </span><span class=nt>login_password</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>mysql_root_password</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-56-84><a id=__codelineno-56-84 name=__codelineno-56-84 href=#__codelineno-56-84></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id=__span-56-85><a id=__codelineno-56-85 name=__codelineno-56-85 href=#__codelineno-56-85></a>
</span><span id=__span-56-86><a id=__codelineno-56-86 name=__codelineno-56-86 href=#__codelineno-56-86></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Rakenduse</span><span class=nv> </span><span class=s>kasutaja</span><span class=nv> </span><span class=s>loomine&quot;</span>
</span><span id=__span-56-87><a id=__codelineno-56-87 name=__codelineno-56-87 href=#__codelineno-56-87></a><span class=w>      </span><span class=nt>mysql_user</span><span class=p>:</span>
</span><span id=__span-56-88><a id=__codelineno-56-88 name=__codelineno-56-88 href=#__codelineno-56-88></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>app_user</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-56-89><a id=__codelineno-56-89 name=__codelineno-56-89 href=#__codelineno-56-89></a><span class=w>        </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>app_password</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-56-90><a id=__codelineno-56-90 name=__codelineno-56-90 href=#__codelineno-56-90></a><span class=w>        </span><span class=nt>priv</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>app_database</span><span class=nv> </span><span class=s>}}.*:ALL&quot;</span>
</span><span id=__span-56-91><a id=__codelineno-56-91 name=__codelineno-56-91 href=#__codelineno-56-91></a><span class=w>        </span><span class=nt>login_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id=__span-56-92><a id=__codelineno-56-92 name=__codelineno-56-92 href=#__codelineno-56-92></a><span class=w>        </span><span class=nt>login_password</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>mysql_root_password</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-56-93><a id=__codelineno-56-93 name=__codelineno-56-93 href=#__codelineno-56-93></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id=__span-56-94><a id=__codelineno-56-94 name=__codelineno-56-94 href=#__codelineno-56-94></a>
</span><span id=__span-56-95><a id=__codelineno-56-95 name=__codelineno-56-95 href=#__codelineno-56-95></a><span class=w>  </span><span class=nt>handlers</span><span class=p>:</span>
</span><span id=__span-56-96><a id=__codelineno-56-96 name=__codelineno-56-96 href=#__codelineno-56-96></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">enable apache</span>
</span><span id=__span-56-97><a id=__codelineno-56-97 name=__codelineno-56-97 href=#__codelineno-56-97></a><span class=w>      </span><span class=nt>service</span><span class=p>:</span>
</span><span id=__span-56-98><a id=__codelineno-56-98 name=__codelineno-56-98 href=#__codelineno-56-98></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apache2</span>
</span><span id=__span-56-99><a id=__codelineno-56-99 name=__codelineno-56-99 href=#__codelineno-56-99></a><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id=__span-56-100><a id=__codelineno-56-100 name=__codelineno-56-100 href=#__codelineno-56-100></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</span><span id=__span-56-101><a id=__codelineno-56-101 name=__codelineno-56-101 href=#__codelineno-56-101></a>
</span><span id=__span-56-102><a id=__codelineno-56-102 name=__codelineno-56-102 href=#__codelineno-56-102></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restart apache</span>
</span><span id=__span-56-103><a id=__codelineno-56-103 name=__codelineno-56-103 href=#__codelineno-56-103></a><span class=w>      </span><span class=nt>service</span><span class=p>:</span>
</span><span id=__span-56-104><a id=__codelineno-56-104 name=__codelineno-56-104 href=#__codelineno-56-104></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apache2</span>
</span><span id=__span-56-105><a id=__codelineno-56-105 name=__codelineno-56-105 href=#__codelineno-56-105></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</span><span id=__span-56-106><a id=__codelineno-56-106 name=__codelineno-56-106 href=#__codelineno-56-106></a>
</span><span id=__span-56-107><a id=__codelineno-56-107 name=__codelineno-56-107 href=#__codelineno-56-107></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">start mysql</span>
</span><span id=__span-56-108><a id=__codelineno-56-108 name=__codelineno-56-108 href=#__codelineno-56-108></a><span class=w>      </span><span class=nt>service</span><span class=p>:</span>
</span><span id=__span-56-109><a id=__codelineno-56-109 name=__codelineno-56-109 href=#__codelineno-56-109></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
</span><span id=__span-56-110><a id=__codelineno-56-110 name=__codelineno-56-110 href=#__codelineno-56-110></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</span><span id=__span-56-111><a id=__codelineno-56-111 name=__codelineno-56-111 href=#__codelineno-56-111></a><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id=__span-56-112><a id=__codelineno-56-112 name=__codelineno-56-112 href=#__codelineno-56-112></a>
</span><span id=__span-56-113><a id=__codelineno-56-113 name=__codelineno-56-113 href=#__codelineno-56-113></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secure mysql</span>
</span><span id=__span-56-114><a id=__codelineno-56-114 name=__codelineno-56-114 href=#__codelineno-56-114></a><span class=w>      </span><span class=nt>mysql_user</span><span class=p>:</span>
</span><span id=__span-56-115><a id=__codelineno-56-115 name=__codelineno-56-115 href=#__codelineno-56-115></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;&quot;</span>
</span><span id=__span-56-116><a id=__codelineno-56-116 name=__codelineno-56-116 href=#__codelineno-56-116></a><span class=w>        </span><span class=nt>host_all</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id=__span-56-117><a id=__codelineno-56-117 name=__codelineno-56-117 href=#__codelineno-56-117></a><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
</span><span id=__span-56-118><a id=__codelineno-56-118 name=__codelineno-56-118 href=#__codelineno-56-118></a><span class=w>        </span><span class=nt>login_user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span id=__span-56-119><a id=__codelineno-56-119 name=__codelineno-56-119 href=#__codelineno-56-119></a><span class=w>        </span><span class=nt>login_password</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>mysql_root_password</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-56-120><a id=__codelineno-56-120 name=__codelineno-56-120 href=#__codelineno-56-120></a>
</span><span id=__span-56-121><a id=__codelineno-56-121 name=__codelineno-56-121 href=#__codelineno-56-121></a><span class=w>  </span><span class=nt>post_tasks</span><span class=p>:</span>
</span><span id=__span-56-122><a id=__codelineno-56-122 name=__codelineno-56-122 href=#__codelineno-56-122></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Teenuste</span><span class=nv> </span><span class=s>oleku</span><span class=nv> </span><span class=s>kontroll&quot;</span>
</span><span id=__span-56-123><a id=__codelineno-56-123 name=__codelineno-56-123 href=#__codelineno-56-123></a><span class=w>      </span><span class=nt>service_facts</span><span class=p>:</span>
</span><span id=__span-56-124><a id=__codelineno-56-124 name=__codelineno-56-124 href=#__codelineno-56-124></a>
</span><span id=__span-56-125><a id=__codelineno-56-125 name=__codelineno-56-125 href=#__codelineno-56-125></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Kinnitada</span><span class=nv> </span><span class=s>Apache&#39;i</span><span class=nv> </span><span class=s>töötamine&quot;</span>
</span><span id=__span-56-126><a id=__codelineno-56-126 name=__codelineno-56-126 href=#__codelineno-56-126></a><span class=w>      </span><span class=nt>uri</span><span class=p>:</span>
</span><span id=__span-56-127><a id=__codelineno-56-127 name=__codelineno-56-127 href=#__codelineno-56-127></a><span class=w>        </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;http://{{</span><span class=nv> </span><span class=s>ansible_default_ipv4.address</span><span class=nv> </span><span class=s>}}&quot;</span>
</span><span id=__span-56-128><a id=__codelineno-56-128 name=__codelineno-56-128 href=#__codelineno-56-128></a><span class=w>        </span><span class=nt>method</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GET</span>
</span><span id=__span-56-129><a id=__codelineno-56-129 name=__codelineno-56-129 href=#__codelineno-56-129></a><span class=w>        </span><span class=nt>status_code</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">200</span>
</span></code></pre></div> <h2 id=playbooki-kaivitamine-ja-debugimine>Playbook'i käivitamine ja debugimine<a class=headerlink href=#playbooki-kaivitamine-ja-debugimine title="Permanent link">&para;</a></h2> <h3 id=pohilised-kaivitamise-voimalused>Põhilised käivitamise võimalused<a class=headerlink href=#pohilised-kaivitamise-voimalused title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-57-1><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=c1># Tavapärane käivitamine</span>
</span><span id=__span-57-2><a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a>ansible-playbook<span class=w> </span>site.yml
</span><span id=__span-57-3><a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a>
</span><span id=__span-57-4><a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=c1># Inventory määramine</span>
</span><span id=__span-57-5><a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a>ansible-playbook<span class=w> </span>-i<span class=w> </span>inventory/production<span class=w> </span>site.yml
</span><span id=__span-57-6><a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a>
</span><span id=__span-57-7><a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a><span class=c1># Muutujate edastamine</span>
</span><span id=__span-57-8><a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a>ansible-playbook<span class=w> </span>-e<span class=w> </span><span class=s2>&quot;app_version=2.1.0&quot;</span><span class=w> </span>site.yml
</span><span id=__span-57-9><a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a>
</span><span id=__span-57-10><a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a><span class=c1># Kuiv käivitamine</span>
</span><span id=__span-57-11><a id=__codelineno-57-11 name=__codelineno-57-11 href=#__codelineno-57-11></a>ansible-playbook<span class=w> </span>--check<span class=w> </span>site.yml
</span><span id=__span-57-12><a id=__codelineno-57-12 name=__codelineno-57-12 href=#__codelineno-57-12></a>
</span><span id=__span-57-13><a id=__codelineno-57-13 name=__codelineno-57-13 href=#__codelineno-57-13></a><span class=c1># Muudatuste kuvamine</span>
</span><span id=__span-57-14><a id=__codelineno-57-14 name=__codelineno-57-14 href=#__codelineno-57-14></a>ansible-playbook<span class=w> </span>--check<span class=w> </span>--diff<span class=w> </span>site.yml
</span></code></pre></div> <h3 id=selektiivne-kaivitamine>Selektiivne käivitamine<a class=headerlink href=#selektiivne-kaivitamine title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-58-1><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=c1># Ainult konkreetsed hostid</span>
</span><span id=__span-58-2><a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a>ansible-playbook<span class=w> </span>--limit<span class=w> </span>webservers<span class=w> </span>site.yml
</span><span id=__span-58-3><a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a>
</span><span id=__span-58-4><a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=c1># Konkreetse task&#39;iga alustamine</span>
</span><span id=__span-58-5><a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a>ansible-playbook<span class=w> </span>--start-at-task<span class=w> </span><span class=s2>&quot;MySQL installimine&quot;</span><span class=w> </span>site.yml
</span><span id=__span-58-6><a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a>
</span><span id=__span-58-7><a id=__codelineno-58-7 name=__codelineno-58-7 href=#__codelineno-58-7></a><span class=c1># Tagide kasutamine</span>
</span><span id=__span-58-8><a id=__codelineno-58-8 name=__codelineno-58-8 href=#__codelineno-58-8></a>ansible-playbook<span class=w> </span>--tags<span class=w> </span><span class=s2>&quot;database&quot;</span><span class=w> </span>site.yml
</span><span id=__span-58-9><a id=__codelineno-58-9 name=__codelineno-58-9 href=#__codelineno-58-9></a>
</span><span id=__span-58-10><a id=__codelineno-58-10 name=__codelineno-58-10 href=#__codelineno-58-10></a><span class=c1># Tagide välistamine</span>
</span><span id=__span-58-11><a id=__codelineno-58-11 name=__codelineno-58-11 href=#__codelineno-58-11></a>ansible-playbook<span class=w> </span>--skip-tags<span class=w> </span><span class=s2>&quot;testing&quot;</span><span class=w> </span>site.yml
</span></code></pre></div> <h3 id=debugimine-ja-verbose-valjund>Debugimine ja verbose väljund<a class=headerlink href=#debugimine-ja-verbose-valjund title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-59-1><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=c1># Põhiline verbose</span>
</span><span id=__span-59-2><a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a>ansible-playbook<span class=w> </span>-v<span class=w> </span>site.yml
</span><span id=__span-59-3><a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a>
</span><span id=__span-59-4><a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=c1># Detailsem väljund</span>
</span><span id=__span-59-5><a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a>ansible-playbook<span class=w> </span>-vv<span class=w> </span>site.yml
</span><span id=__span-59-6><a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a>
</span><span id=__span-59-7><a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a><span class=c1># Connection debugging</span>
</span><span id=__span-59-8><a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a>ansible-playbook<span class=w> </span>-vvv<span class=w> </span>site.yml
</span><span id=__span-59-9><a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a>
</span><span id=__span-59-10><a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a><span class=c1># SSH debugging</span>
</span><span id=__span-59-11><a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a>ansible-playbook<span class=w> </span>-vvvv<span class=w> </span>site.yml
</span></code></pre></div> <h2 id=best-practices>Best practices<a class=headerlink href=#best-practices title="Permanent link">&para;</a></h2> <h3 id=playbooki-struktuur>Playbook'i struktuur<a class=headerlink href=#playbooki-struktuur title="Permanent link">&para;</a></h3> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-60-1><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=nn>---</span>
</span><span id=__span-60-2><a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=c1># Dokumentatsioon playbook&#39;i alguses</span>
</span><span id=__span-60-3><a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a><span class=c1># Autor: IT meeskond</span>
</span><span id=__span-60-4><a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a><span class=c1># Eesmärk: Veebiserveri täielik seadistamine</span>
</span><span id=__span-60-5><a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a><span class=c1># Versioon: 1.2.0</span>
</span><span id=__span-60-6><a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a>
</span><span id=__span-60-7><a id=__codelineno-60-7 name=__codelineno-60-7 href=#__codelineno-60-7></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Selge</span><span class=nv> </span><span class=s>ja</span><span class=nv> </span><span class=s>kirjeldav</span><span class=nv> </span><span class=s>play</span><span class=nv> </span><span class=s>nimi&quot;</span>
</span><span id=__span-60-8><a id=__codelineno-60-8 name=__codelineno-60-8 href=#__codelineno-60-8></a><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
</span><span id=__span-60-9><a id=__codelineno-60-9 name=__codelineno-60-9 href=#__codelineno-60-9></a><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id=__span-60-10><a id=__codelineno-60-10 name=__codelineno-60-10 href=#__codelineno-60-10></a><span class=w>  </span><span class=nt>gather_facts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id=__span-60-11><a id=__codelineno-60-11 name=__codelineno-60-11 href=#__codelineno-60-11></a>
</span><span id=__span-60-12><a id=__codelineno-60-12 name=__codelineno-60-12 href=#__codelineno-60-12></a><span class=w>  </span><span class=nt>vars</span><span class=p>:</span>
</span><span id=__span-60-13><a id=__codelineno-60-13 name=__codelineno-60-13 href=#__codelineno-60-13></a><span class=w>    </span><span class=c1># Muutujate gruppeerimine ja kommentaarid</span>
</span><span id=__span-60-14><a id=__codelineno-60-14 name=__codelineno-60-14 href=#__codelineno-60-14></a><span class=w>    </span><span class=c1># Rakenduse konfiguratsioon</span>
</span><span id=__span-60-15><a id=__codelineno-60-15 name=__codelineno-60-15 href=#__codelineno-60-15></a><span class=w>    </span><span class=nt>app_name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;webstore&quot;</span>
</span><span id=__span-60-16><a id=__codelineno-60-16 name=__codelineno-60-16 href=#__codelineno-60-16></a><span class=w>    </span><span class=nt>app_version</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2.1.0&quot;</span>
</span><span id=__span-60-17><a id=__codelineno-60-17 name=__codelineno-60-17 href=#__codelineno-60-17></a>
</span><span id=__span-60-18><a id=__codelineno-60-18 name=__codelineno-60-18 href=#__codelineno-60-18></a><span class=w>    </span><span class=c1># Andmebaasi seadistused  </span>
</span><span id=__span-60-19><a id=__codelineno-60-19 name=__codelineno-60-19 href=#__codelineno-60-19></a><span class=w>    </span><span class=nt>db_name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>app_name</span><span class=nv> </span><span class=s>}}_production&quot;</span>
</span><span id=__span-60-20><a id=__codelineno-60-20 name=__codelineno-60-20 href=#__codelineno-60-20></a><span class=w>    </span><span class=nt>db_user</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>app_name</span><span class=nv> </span><span class=s>}}_user&quot;</span>
</span><span id=__span-60-21><a id=__codelineno-60-21 name=__codelineno-60-21 href=#__codelineno-60-21></a>
</span><span id=__span-60-22><a id=__codelineno-60-22 name=__codelineno-60-22 href=#__codelineno-60-22></a><span class=w>  </span><span class=nt>pre_tasks</span><span class=p>:</span>
</span><span id=__span-60-23><a id=__codelineno-60-23 name=__codelineno-60-23 href=#__codelineno-60-23></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Eeltingimuste</span><span class=nv> </span><span class=s>kontroll&quot;</span>
</span><span id=__span-60-24><a id=__codelineno-60-24 name=__codelineno-60-24 href=#__codelineno-60-24></a><span class=w>      </span><span class=nt>assert</span><span class=p>:</span>
</span><span id=__span-60-25><a id=__codelineno-60-25 name=__codelineno-60-25 href=#__codelineno-60-25></a><span class=w>        </span><span class=nt>that</span><span class=p>:</span>
</span><span id=__span-60-26><a id=__codelineno-60-26 name=__codelineno-60-26 href=#__codelineno-60-26></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">app_name is defined</span>
</span><span id=__span-60-27><a id=__codelineno-60-27 name=__codelineno-60-27 href=#__codelineno-60-27></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">app_version is defined</span>
</span><span id=__span-60-28><a id=__codelineno-60-28 name=__codelineno-60-28 href=#__codelineno-60-28></a><span class=w>        </span><span class=nt>fail_msg</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Nõutavad</span><span class=nv> </span><span class=s>muutujad</span><span class=nv> </span><span class=s>ei</span><span class=nv> </span><span class=s>ole</span><span class=nv> </span><span class=s>määratud&quot;</span>
</span><span id=__span-60-29><a id=__codelineno-60-29 name=__codelineno-60-29 href=#__codelineno-60-29></a>
</span><span id=__span-60-30><a id=__codelineno-60-30 name=__codelineno-60-30 href=#__codelineno-60-30></a><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span>
</span><span id=__span-60-31><a id=__codelineno-60-31 name=__codelineno-60-31 href=#__codelineno-60-31></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Konkreetne</span><span class=nv> </span><span class=s>ja</span><span class=nv> </span><span class=s>arusaadav</span><span class=nv> </span><span class=s>task&#39;i</span><span class=nv> </span><span class=s>nimi&quot;</span>
</span><span id=__span-60-32><a id=__codelineno-60-32 name=__codelineno-60-32 href=#__codelineno-60-32></a><span class=w>      </span><span class=nt>module_name</span><span class=p>:</span>
</span><span id=__span-60-33><a id=__codelineno-60-33 name=__codelineno-60-33 href=#__codelineno-60-33></a><span class=w>        </span><span class=nt>parameter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">value</span>
</span><span id=__span-60-34><a id=__codelineno-60-34 name=__codelineno-60-34 href=#__codelineno-60-34></a><span class=w>      </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>installation</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>webserver</span><span class="p p-Indicator">]</span>
</span><span id=__span-60-35><a id=__codelineno-60-35 name=__codelineno-60-35 href=#__codelineno-60-35></a><span class=w>      </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>
</span><span id=__span-60-36><a id=__codelineno-60-36 name=__codelineno-60-36 href=#__codelineno-60-36></a>
</span><span id=__span-60-37><a id=__codelineno-60-37 name=__codelineno-60-37 href=#__codelineno-60-37></a><span class=w>  </span><span class=nt>post_tasks</span><span class=p>:</span>
</span><span id=__span-60-38><a id=__codelineno-60-38 name=__codelineno-60-38 href=#__codelineno-60-38></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Lõpukontrollid</span><span class=nv> </span><span class=s>ja</span><span class=nv> </span><span class=s>validateerimised&quot;</span>
</span><span id=__span-60-39><a id=__codelineno-60-39 name=__codelineno-60-39 href=#__codelineno-60-39></a><span class=w>      </span><span class=nt>uri</span><span class=p>:</span>
</span><span id=__span-60-40><a id=__codelineno-60-40 name=__codelineno-60-40 href=#__codelineno-60-40></a><span class=w>        </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;http://localhost&quot;</span>
</span><span id=__span-60-41><a id=__codelineno-60-41 name=__codelineno-60-41 href=#__codelineno-60-41></a><span class=w>        </span><span class=nt>status_code</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">200</span>
</span></code></pre></div> <h3 id=vigade-kasitlemise-strateegiad>Vigade käsitlemise strateegiad<a class=headerlink href=#vigade-kasitlemise-strateegiad title="Permanent link">&para;</a></h3> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-61-1><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=nt>tasks</span><span class=p>:</span>
</span><span id=__span-61-2><a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Kriitilise</span><span class=nv> </span><span class=s>teenuse</span><span class=nv> </span><span class=s>käivitamine&quot;</span>
</span><span id=__span-61-3><a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=w>    </span><span class=nt>service</span><span class=p>:</span>
</span><span id=__span-61-4><a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">critical-service</span>
</span><span id=__span-61-5><a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a><span class=w>      </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</span><span id=__span-61-6><a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a><span class=w>    </span><span class=nt>register</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service_result</span>
</span><span id=__span-61-7><a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a><span class=w>    </span><span class=nt>failed_when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service_result.rc != 0</span>
</span><span id=__span-61-8><a id=__codelineno-61-8 name=__codelineno-61-8 href=#__codelineno-61-8></a>
</span><span id=__span-61-9><a id=__codelineno-61-9 name=__codelineno-61-9 href=#__codelineno-61-9></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Mittekriitilise</span><span class=nv> </span><span class=s>operatsiooni</span><span class=nv> </span><span class=s>katse&quot;</span>
</span><span id=__span-61-10><a id=__codelineno-61-10 name=__codelineno-61-10 href=#__codelineno-61-10></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/opt/scripts/optional-task.sh</span>
</span><span id=__span-61-11><a id=__codelineno-61-11 name=__codelineno-61-11 href=#__codelineno-61-11></a><span class=w>    </span><span class=nt>ignore_errors</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id=__span-61-12><a id=__codelineno-61-12 name=__codelineno-61-12 href=#__codelineno-61-12></a>
</span><span id=__span-61-13><a id=__codelineno-61-13 name=__codelineno-61-13 href=#__codelineno-61-13></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Retry</span><span class=nv> </span><span class=s>loogikaga</span><span class=nv> </span><span class=s>operatsioon&quot;</span>
</span><span id=__span-61-14><a id=__codelineno-61-14 name=__codelineno-61-14 href=#__codelineno-61-14></a><span class=w>    </span><span class=nt>uri</span><span class=p>:</span>
</span><span id=__span-61-15><a id=__codelineno-61-15 name=__codelineno-61-15 href=#__codelineno-61-15></a><span class=w>      </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;http://api.external.com/status&quot;</span>
</span><span id=__span-61-16><a id=__codelineno-61-16 name=__codelineno-61-16 href=#__codelineno-61-16></a><span class=w>      </span><span class=nt>method</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GET</span>
</span><span id=__span-61-17><a id=__codelineno-61-17 name=__codelineno-61-17 href=#__codelineno-61-17></a><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-61-18><a id=__codelineno-61-18 name=__codelineno-61-18 href=#__codelineno-61-18></a><span class=w>    </span><span class=nt>delay</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span><span id=__span-61-19><a id=__codelineno-61-19 name=__codelineno-61-19 href=#__codelineno-61-19></a><span class=w>    </span><span class=nt>until</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">result.status == 200</span>
</span></code></pre></div> <h2 id=kokkuvote_3>Kokkuvõte<a class=headerlink href=#kokkuvote_3 title="Permanent link">&para;</a></h2> <p>YAML süntaks ja playbook'ide struktuur moodustavad Ansible automatiseerimise aluse. Korrektselt struktureeritud playbook'id on loetavad, hallatavad ja usaldusväärsed. Järgmises peatükis käsitletakse advanced Ansible funktsionaalsusi nagu roles, templates ja error handling.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Viimane uuendus"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="20. september 2025 12:44:39 UTC">20. september 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Loodud> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="18. september 2025 11:24:29 UTC">18. september 2025</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Kas see leht oli kasulik? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="See leht oli kasulik" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="See leht vajab täiendamist" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Aitäh tagasiside eest! </div> <div data-md-value=0 hidden> Aitäh tagasiside eest! Kasuta <a href="https://github.com/mtalvik/automation/issues/new/?title=[Feedback]+Ansible%20alused" target=_blank rel=noopener>GitHub issues</a> täpsema tagasiside andmiseks. </div> </div> </div> </fieldset> </form> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Üles </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Jalus> <a href=../../docker_orchestration/homework/ class="md-footer__link md-footer__link--prev" aria-label="Eelmine: Orkestreerimise kodutöö"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Eelmine </span> <div class=md-ellipsis> Orkestreerimise kodutöö </div> </div> </a> <a href=../lab/ class="md-footer__link md-footer__link--next" aria-label="Järgmine: Ansible praktikum"> <div class=md-footer__title> <span class=md-footer__direction> Järgmine </span> <div class=md-ellipsis> Ansible praktikum </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 Maria Talvik </div> </div> <div class=md-social> <a href=https://github.com/mtalvik target=_blank rel=noopener title=GitHub class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://linkedin.com/in/maria-talvik target=_blank rel=noopener title=LinkedIn class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://mariatalvik.ee target=_blank rel=noopener title=Blogi class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M224 24c0-13.3 10.7-24 24-24 145.8 0 264 118.2 264 264 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-119.3-96.7-216-216-216-13.3 0-24-10.7-24-24M80 96c26.5 0 48 21.5 48 48v224c0 26.5 21.5 48 48 48s48-21.5 48-48-21.5-48-48-48c-8.8 0-16-7.2-16-16v-64c0-8.8 7.2-16 16-16 79.5 0 144 64.5 144 144s-64.5 144-144 144S32 447.5 32 368V144c0-26.5 21.5-48 48-48m168 0c92.8 0 168 75.2 168 168 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-66.3-53.7-120-120-120-13.3 0-24-10.7-24-24s10.7-24 24-24"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Küpsiste nõusolek</h4> <p>Kasutame küpsiseid, et jälgida kasutusstatistikat ja parandada kasutajakogemust. Sinu nõusolekuga aitad meil muuta õppematerjale paremaks.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Nõustu</button> <button type=reset class="md-button md-button--primary">Keeldu</button> <label class=md-button for=__settings>Halda seadeid</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.progress", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": {"Ansible": "ansible", "CI/CD": "cicd", "Docker": "docker", "Git": "git", "Kodut\u00f6\u00f6": "homework", "Kubernetes": "k8s", "Praktikum": "lab", "Teooria": "lecture", "Terraform": "terraform"}, "translations": {"clipboard.copied": "Kopeeritud", "clipboard.copy": "Kopeeri l\u00f5ikelauale", "search.result.more.one": "1 veel sellel lehel", "search.result.more.other": "# veel sellel lehel", "search.result.none": "Otsingule ei leitud \u00fchtegi vastet", "search.result.one": "Leiti \u00fcks tulemus", "search.result.other": "Leiti # tulemust", "search.result.placeholder": "Otsimiseks kirjuta siia", "search.result.term.missing": "Puudub", "select.version": "Vali versioon"}, "version": {"default": "stable", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>