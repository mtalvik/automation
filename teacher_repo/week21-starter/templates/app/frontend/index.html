<!DOCTYPE html>
<html>
<head>
    <title>Week 21 Homework</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px; 
            background-color: #f5f5f5;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status { 
            background-color: #d4edda; 
            color: #155724; 
            padding: 15px; 
            border-radius: 4px;
            margin: 10px 0;
        }
        .error { 
            background-color: #f8d7da; 
            color: #721c24; 
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .api-section {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        pre {
            background-color: #f1f1f1;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Week 21 Homework</h1>
        <h2>Docker Compose Multi-Container App</h2>
        
        <div id="status" class="status">
            <h3>üìä Rakenduse staatus</h3>
            <p><strong>Frontend:</strong> <span id="frontend-status">‚úÖ T√∂√∂tab</span></p>
            <p><strong>Backend:</strong> <span id="backend-status">‚è≥ Kontrollin...</span></p>
            <p><strong>Database:</strong> <span id="db-status">‚è≥ Kontrollin...</span></p>
            <p><strong>Aeg:</strong> <span id="timestamp"></span></p>
        </div>

        <div class="api-section">
            <h3>üîß API Testimine</h3>
            <button onclick="testBackend()">Testi Backend'i</button>
            <button onclick="testDatabase()">Testi Andmebaasi</button>
            <button onclick="testHealth()">Health Check</button>
            <button onclick="refreshStatus()">V√§rskenda</button>
        </div>

        <div id="results"></div>

        <div class="api-section">
            <h3>üìö API Endpoint'id</h3>
            <p><strong>GET /api/status</strong> - Rakenduse √ºldine staatus</p>
            <p><strong>GET /api/db-test</strong> - Andmebaasi √ºhenduse test</p>
            <p><strong>GET /api/health</strong> - Tervise kontroll</p>
        </div>
    </div>

    <script>
        // V√§rskenda aega
        function updateTime() {
            document.getElementById('timestamp').textContent = new Date().toLocaleString();
        }
        updateTime();
        setInterval(updateTime, 1000);

        // Testi backend'i
        async function testBackend() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                document.getElementById('backend-status').textContent = '‚úÖ T√∂√∂tab';
                document.getElementById('db-status').textContent = data.database === 'Connected' ? '‚úÖ T√∂√∂tab' : '‚ùå Ei t√∂√∂ta';
                
                document.getElementById('results').innerHTML = `
                    <div class="status">
                        <h4>Backend vastus:</h4>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                document.getElementById('backend-status').textContent = '‚ùå Ei t√∂√∂ta';
                document.getElementById('results').innerHTML = `
                    <div class="status error">
                        <h4>Viga:</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Testi andmebaasi
        async function testDatabase() {
            try {
                const response = await fetch('/api/db-test');
                const data = await response.json();
                
                document.getElementById('results').innerHTML = `
                    <div class="status">
                        <h4>Andmebaasi test:</h4>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                document.getElementById('results').innerHTML = `
                    <div class="status error">
                        <h4>Andmebaasi viga:</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Testi health check
        async function testHealth() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                
                document.getElementById('results').innerHTML = `
                    <div class="status">
                        <h4>Health Check:</h4>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                document.getElementById('results').innerHTML = `
                    <div class="status error">
                        <h4>Health Check viga:</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // V√§rskenda staatust
        function refreshStatus() {
            testBackend();
        }

        // Kontrolli staatust lehe laadimisel
        window.onload = function() {
            testBackend();
        };
    </script>
</body>
</html>
